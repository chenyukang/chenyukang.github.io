<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and writing">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  <meta property="og:site_name" content="ç¨‹åºå‘˜çš„å–µ">
  <meta property="og:title" content="Types and Programming Languages (3) | ç¨‹åºå‘˜çš„å–µ" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content=" http://catcoding.me/css/images/logo.png " />
  <link rel="alternate" type="application/rss+xml" title="ç¨‹åºå‘˜çš„å–µ; Feed" href="https://catcoding.me/atom.xml" />

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/prism.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">

  
<script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/geopattern.min.js"></script>
<script src="/js/nprogress.min.js"></script>

  
  
  <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
    
    Types and Programming Languages (3) |
    ç¨‹åºå‘˜çš„å–µ
    
  </title>

  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="/css/images/logo.png" width='400px' height='400px' />
  </div>

  
  


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-77282254-1');
  </script>

<meta name="generator" content="Hexo 5.4.2"></head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ç¨‹åºå‘˜çš„å–µ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/links/" class="item-link">Links</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      

        <li class="list-item" style="margin: 0">
       <a class="icon-small" href="/search">
        <span class="fa-stack fa-lg">
          <i class="fa fa-search fa-stack-1x fa-inverse" style="color:#8ccb8c"></i>
        </span>
       </a>
      </li>

       <li class="list-item" style="margin-left: 3px">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>
    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/links/" class="menu-link">Links</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Types and Programming Languages (3)</h2>
  <p class="post-date">2015-03-07</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>


<main class="app-body flex-box">


  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2 id="Subtyping"><a href="#Subtyping" class="headerlink" title="Subtyping"></a>Subtyping</h2><p>subtyping è§£å†³çš„é—®é¢˜æ˜¯å¤šæ€ï¼ŒOO çš„ä¸€ä¸ªåŸºæœ¬è¦ç´ ã€‚</p>
<blockquote>
<p>we say that S is a subtype of T, written S &lt;: T, to mean that any term of type S can safely be used in a context where a term of type T is expected. This view of subtyping is often called the principle of safe substitution.</p>
</blockquote>
<p>è¿™ç« åªæ˜¯ä»¥ record æ¥ä½œä¸ºä¾‹å­è¯´æ˜ï¼Œç›´ç™½çš„æ‰€ä¸€ä¸ªç±»å‹ S æ˜¯å¦å¤–ä¸€ä¸ªç±»å‹çš„ T çš„å­ç±»å‹ï¼Œæ„æ€æ˜¯ä»»ä½•ä½¿ç”¨ T çš„ contextï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨çš„ä½¿ç”¨ Sã€‚å¯¹äº record ç±»å‹æ¥è¯´ï¼Œfield æ•°é‡å¤šçš„æ˜¯ field æ•°é‡å°‘çš„å­ç±»å‹ï¼Œå› ä¸ºè¿™æ ·ä»»ä½•ä» T è¦å–å¾—çš„ field éƒ½å¯ä»¥ä»å­ç±»å‹é‡Œé¢å–åˆ°ã€‚</p>
<p>å¯¹äºå‡½æ•°ç±»å‹æ¥è¯´ï¼Œå¦‚æœ<code>S1-&gt;S2</code>, <code>T1-&gt;T2</code>, S1 æ˜¯ T1 çš„å­ç±»å‹ï¼ŒS2 æ˜¯ T2 çš„å­ç±»è¡Œï¼Œé‚£ä¹ˆ<code>S1-&gt;S2</code>æ˜¯<code>T1-&gt;T2</code>çš„å­ç±»å‹ã€‚</p>
<p>å¼•å…¥ Top ç±»å‹ï¼Œæ˜¯æ‰€æœ‰ç±»å‹çš„çˆ¶ç±»ï¼Œå¯¹åº”å¾ˆå¤šç¼–ç¨‹è¯­è¨€é‡Œé¢çš„ Object(OOP é‡Œé¢å¸¸è§çš„ä¼ä¿©)ï¼ŒGo é‡Œé¢æˆ‘å°±è¿™æ ·å®šä¹‰ï¼š</p>
<pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Object <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¼•å…¥ Bottom ç±»å‹ä¼¼ä¹å°±æ²¡ä»€ä¹ˆå¤§ç”¨å¤„äº†ï¼Œè¿˜å¢åŠ äº† typecheker çš„å¤æ‚åº¦ã€‚</p>
<h2 id="Ascription-and-Casting"><a href="#Ascription-and-Casting" class="headerlink" title="Ascription and Casting"></a>Ascription and Casting</h2><p>ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼Œåˆ†ä¸º up-cast å’Œ down-castã€‚up-cast å¯¹äºç±»å‹æ£€æŸ¥æ¥è¯´è¦ç®€å•ä¸€äº›ï¼Œæ¯”å¦‚ç±»å‹<code>Animal -&gt; Dog</code>, <code>Animal -&gt; Cat</code>ï¼Œç”±<code>Cat</code>åˆ°<code>Animal</code>çš„ç±»å‹è½¬æ¢ä¸º up-castã€‚åœ¨å¾ˆå¤šè¯­è¨€é‡Œé¢æ˜¯å½“åšä¸€ç§æŠ½è±¡æ–¹æ³•ã€‚</p>
<p>down-cast è¦å¤æ‚ä¸€äº›ï¼Œè€Œä¸”ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ç±»å‹ç³»ç»Ÿçš„ä¸å®‰å…¨ï¼Œæ¯”å¦‚ï¼š</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml">f <span class="token operator">=</span> Î»<span class="token punctuation">(</span>x<span class="token punctuation">:</span>Top<span class="token punctuation">)</span> <span class="token punctuation">(</span>x <span class="token keyword">as</span> <span class="token punctuation">&#123;</span>a<span class="token punctuation">:</span>Nat<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªå‡½æ•°æ¥æ”¶ä»»ä½•ç±»å‹çš„å‚æ•°ï¼Œä½†æ˜¯éšå«ä¸€ä¸ªå‡è®¾ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æˆå‘˜å˜é‡ä¸ºæ•°å­—ç±»å‹çš„ aï¼Œå¦‚æœä¼ é€’ä¸€ä¸ªé”™è¯¯çš„å‚æ•° typechecker ä¹Ÿä¸æŠ¥é”™ï¼Œä½†è¿è¡Œçš„æ—¶å€™å°±ä¼šæœ‰é”™è¯¯äº†ã€‚æ‰€ä»¥å«æœ‰ down-cast çš„ç±»å‹ç³»ç»Ÿåº”è¯¥éµå¾ªï¼š <code>trust, but verify</code>ï¼Œç¼–è¯‘çš„æ—¶å€™ä¸æŠ¥é”™ï¼Œä½†æ˜¯ç•™ç€è¿è¡Œçš„æ—¶å€™æ£€æŸ¥ã€‚ä¸ºäº†é¿å… down-cast å¼•èµ·çš„å¤æ‚é—®é¢˜ï¼ŒML ç­‰è¯­è¨€é€‰æ‹©çš„æ˜¯<code>down-cast with type tags</code>ã€‚</p>
<p><code>channels</code>:</p>
<blockquote>
<p>The key observation is that, from the point of view of typing, a communication channel behaves exactly like a reference cell: it can be used for both reading and writing, and, since it is difficult to determine statically which reads correspond to which writes, the only simple way to ensure type safety is to require that all the values passed along the channel must belong to the same type.</p>
</blockquote>
<p>subtyping çš„å¼•å…¥å¯¼è‡´åˆ†æ”¯å¤šçš„æƒ…å†µä¸‹ç±»å‹æ£€æŸ¥éº»çƒ¦ï¼Œå› æ­¤å¼•å…¥äº† Join å’Œ Meet çš„æ¦‚å¿µï¼Œå®ç°å¯å‚è€ƒä»£ç é‡Œé¢çš„ï¼š</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml"><span class="token keyword">let</span> <span class="token keyword">rec</span> join ctx tyS tyT <span class="token operator">=</span>
  <span class="token keyword">if</span> subtype ctx tyS tyT <span class="token keyword">then</span> tyT <span class="token keyword">else</span>
  <span class="token keyword">if</span> subtype ctx tyT tyS <span class="token keyword">then</span> tyS <span class="token keyword">else</span>
  <span class="token keyword">let</span> tyS <span class="token operator">=</span> simplifyty ctx tyS <span class="token keyword">in</span>
  <span class="token keyword">let</span> tyT <span class="token operator">=</span> simplifyty ctx tyT <span class="token keyword">in</span>
  <span class="token keyword">match</span> <span class="token punctuation">(</span>tyS<span class="token punctuation">,</span>tyT<span class="token punctuation">)</span> <span class="token keyword">with</span>
    <span class="token punctuation">(</span>TyArr<span class="token punctuation">(</span>tyS1<span class="token punctuation">,</span>tyS2<span class="token punctuation">)</span><span class="token punctuation">,</span>TyArr<span class="token punctuation">(</span>tyT1<span class="token punctuation">,</span>tyT2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-></span>
      TyArr<span class="token punctuation">(</span>meet ctx  tyS1 tyT1<span class="token punctuation">,</span> join ctx tyS2 tyT2<span class="token punctuation">)</span>
  <span class="token operator">|</span> <span class="token punctuation">_</span> <span class="token operator">-></span>
      TyTop

<span class="token operator">and</span> meet ctx tyS tyT <span class="token operator">=</span>
  <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="Case-Study-Imperative-Objects"><a href="#Case-Study-Imperative-Objects" class="headerlink" title="Case Study: Imperative Objects"></a>Case Study: Imperative Objects</h2><p>ä¸è€ƒè™‘å®ç°æ•ˆç‡å’Œè¯­æ³•ç®€æ´çš„æ¡ä»¶ä¸‹ï¼Œç›®å‰ä¸ºæ­¢å­¦åˆ°çš„è¯­è¨€ç‰¹æ€§å·²ç»è¶³å¤Ÿæ¥æ¨¡æ‹Ÿå®ç° OOPã€‚æœ€ç®€å•çš„ä¾‹å­å°±æ˜¯ä¸€ä¸ª counter:</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml">c <span class="token operator">=</span> <span class="token keyword">let</span> x <span class="token operator">=</span> ref <span class="token number">1</span> <span class="token keyword">in</span>
    <span class="token punctuation">&#123;</span>get <span class="token operator">=</span> Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> <span class="token operator">!</span>x<span class="token punctuation">,</span>
    inc <span class="token operator">=</span> Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> x<span class="token operator">:=</span>succ<span class="token punctuation">(</span><span class="token operator">!</span>x<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>OOP ä½œä¸ºä¸€ç§æŠ½è±¡æ‰‹æ®µï¼Œå¯ä»¥è®©é€šè¿‡æ¥å£æ¥éšè—å®ç°ï¼Œå®¢æˆ·ç«¯çš„ä»£ç åªé€šè¿‡åŒä¸€ä¸ªæ¥å£æ‰æ“ä½œå„ç§å­ç±»çš„å¯¹è±¡ã€‚è¿™é‡Œçš„ä¾‹å­ä¸€ä¸ªå­ç±»åªæ˜¯æ¯”çˆ¶ç±»å¤šæ¥å£è€Œå·²ã€‚</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml">newResetCounter <span class="token operator">=</span>
    Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> <span class="token keyword">let</span> x <span class="token operator">=</span> ref <span class="token number">1</span> <span class="token keyword">in</span>
    <span class="token punctuation">&#123;</span>get <span class="token operator">=</span> Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> <span class="token operator">!</span>x<span class="token punctuation">,</span>
    inc <span class="token operator">=</span> Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> x<span class="token operator">:=</span>succ<span class="token punctuation">(</span><span class="token operator">!</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> reset <span class="token operator">=</span> Î»<span class="token punctuation">_</span><span class="token punctuation">:</span>Unit<span class="token punctuation">.</span> x<span class="token operator">:=</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>self çš„ç®€å•æ˜¯ç°å®éœ€è¦åŠ¨æ€æ‰¾åˆ°å¯¹åº”çš„ methodï¼Œæ›´é«˜æ•ˆçš„å®ç°å½“ç„¶æ˜¯å¯¹è±¡åˆ›å»ºå¥½å method table å»ºå¥½ã€‚</p>
</section>

    <p></p>
    <!-- äºŒç»´ç  START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.jpg" height="160" width="160">
            <figcaption>å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»</figcaption>
      </div>
    

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#OCaml" >
    <span class="tag-code">OCaml</span>
  </a>

  <a href="/tags#PL" >
    <span class="tag-code">PL</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2015/03/07/types-and-programming-languages-2.html">
        <span class="nav-arrow">â† </span>
        
          Types and Programming ...
        
      </a>
    
    
      <a class="nav-right" href="/2015/03/01/types-and-programming-languages.html">
        
          Types and Programming  ...
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->

    <!-- äºŒç»´ç  END -->
    
      <!-- No Comment -->
    



    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>


  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Subtyping"><span class="toc-nav-text">Subtyping</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Ascription-and-Casting"><span class="toc-nav-text">Ascription and Casting</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Case-Study-Imperative-Objects"><span class="toc-nav-text">Case Study: Imperative Objects</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://catcoding.me/2015/03/07/types-and-programming-languages-3.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW * 3 / 4}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy;
        2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a> with <a target="_blank" rel="noopener" href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
    </p>
</footer>

<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function(e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("//catcoding.me/js/fastclick.min.js", function() {
        FastClick.attach(document.body);
    })
</script>


<script src="/js/script.js"></script>

  </body>
</html>