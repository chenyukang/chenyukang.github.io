<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and software">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  
    <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
      
          Types and Programming Languages (3) | Yukang&#39;s Page
      
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>

  <div style="margin:0 auto;width:0px;height:0px;overflow:hidden;">
      <img src="/css/images/logo.png" width="400px" height="400px">
  </div>

  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  



</head>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Yukang's Page</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Types and Programming Languages (3)</h2>
  <p class="post-date">2015-03-07</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2 id="Subtyping"><a href="#Subtyping" class="headerlink" title="Subtyping"></a>Subtyping</h2><p>subtyping解决的问题是多态，OO的一个基本要素。</p>
<pre><code>we say that S is a subtype of T, written S &lt;: T, to mean that any term of type S can safely be used in a context where a term of type T is expected. This view of subtyping is often called the principle of safe substitution.
</code></pre><p>这章只是以record来作为例子说明，直白的所一个类型S是另外一个类型的T的子类型，意思是任何使用T的context，我们可以安全的使用S。对于record类型来说，field数量多的是field数量少的子类型，因为这样任何从T要取得的field都可以从子类型里面取到。</p>
<p>对于函数类型来说，如果<code>S1-&gt;S2</code>, <code>T1-&gt;T2</code>, S1是T1的子类型，S2是T2的子类行，那么<code>S1-&gt;S2</code>是<code>T1-&gt;T2</code>的子类型。</p>
<p>引入Top类型，是所有类型的父类，对应很多编程语言里面的Object(OOP里面常见的伎俩)，Go里面我就这样定义：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Object <span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>引入Bottom类型似乎就没什么大用处了，还增加了typecheker的复杂度。</p>
<h2 id="Ascription-and-Casting"><a href="#Ascription-and-Casting" class="headerlink" title="Ascription and Casting"></a>Ascription and Casting</h2><p>类型的强制转换，分为up-cast和down-cast。up-cast对于类型检查来说要简单一些，比如类型<code>Animal -&gt; Dog</code>, <code>Animal -&gt; Cat</code>，由<code>Cat</code>到<code>Animal</code>的类型转换为up-cast。在很多语言里面是当做一种抽象方法。</p>
<p>down-cast要复杂一些，而且也可能会导致类型系统的不安全，比如：</p>
<figure class="highlight ocaml"><table><tr><td class="code"><pre><span class="line">f = λ(x:<span class="type">Top</span>) (x <span class="keyword">as</span> &#123;a:<span class="type">Nat</span>&#125;).a;</span><br></pre></td></tr></table></figure>
<p>这个函数接收任何类型的参数，但是隐含一个假设，必须是一个有成员变量为数字类型的a，如果传递一个错误的参数typechecker也不报错，但运行的时候就会有错误了。所以含有down-cast的类型系统应该遵循： <code>trust, but verify</code>，编译的时候不报错，但是留着运行的时候检查。为了避免down-cast引起的复杂问题，ML等语言选择的是<code>down-cast with type tags</code>。</p>
<p><code>channels</code>:</p>
<pre><code>The key observation is that, from the point of view of typing, a communication channel behaves exactly like a reference cell: it can be used for both reading and writing, and, since it is difficult to determine statically which reads correspond to which writes, the only simple way to ensure type safety is to require that all the values passed along the channel must belong to the same type.
</code></pre><p>subtyping的引入导致分支多的情况下类型检查麻烦，因此引入了Join和Meet的概念，实现可参考代码里面的:</p>
<figure class="highlight ocaml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="keyword">rec</span> join ctx tyS tyT =</span><br><span class="line">  <span class="keyword">if</span> subtype ctx tyS tyT <span class="keyword">then</span> tyT <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">if</span> subtype ctx tyT tyS <span class="keyword">then</span> tyS <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">let</span> tyS = simplifyty ctx tyS <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">let</span> tyT = simplifyty ctx tyT <span class="keyword">in</span></span><br><span class="line">  <span class="keyword">match</span> (tyS,tyT) <span class="keyword">with</span></span><br><span class="line">    (<span class="type">TyArr</span>(tyS1,tyS2),<span class="type">TyArr</span>(tyT1,tyT2)) -&gt;</span><br><span class="line">      <span class="type">TyArr</span>(meet ctx  tyS1 tyT1, join ctx tyS2 tyT2)</span><br><span class="line">  | _ -&gt;</span><br><span class="line">      <span class="type">TyTop</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> meet ctx tyS tyT =</span><br><span class="line">  .......</span><br></pre></td></tr></table></figure>
<h2 id="Case-Study-Imperative-Objects"><a href="#Case-Study-Imperative-Objects" class="headerlink" title="Case Study: Imperative Objects"></a>Case Study: Imperative Objects</h2><p>不考虑实现效率和语法简洁的条件下，目前为止学到的语言特性已经足够来模拟实现OOP。最简单的例子就是一个counter:</p>
<figure class="highlight ocaml"><table><tr><td class="code"><pre><span class="line">c = <span class="keyword">let</span> x = <span class="built_in">ref</span> <span class="number">1</span> <span class="keyword">in</span></span><br><span class="line">    &#123;get = λ_:<span class="type">Unit</span>. !x,</span><br><span class="line">    inc = λ_:<span class="type">Unit</span>. x:=succ(!x)&#125;;</span><br></pre></td></tr></table></figure>
<p>OOP作为一种抽象手段，可以让通过接口来隐藏实现，客户端的代码只通过同一个接口才操作各种子类的对象。这里的例子一个子类只是比父类多接口而已。</p>
<figure class="highlight ocaml"><table><tr><td class="code"><pre><span class="line">newResetCounter =</span><br><span class="line">    λ_:<span class="type">Unit</span>. <span class="keyword">let</span> x = <span class="built_in">ref</span> <span class="number">1</span> <span class="keyword">in</span></span><br><span class="line">    &#123;get = λ_:<span class="type">Unit</span>. !x,</span><br><span class="line">    inc = λ_:<span class="type">Unit</span>. x:=succ(!x), reset = λ_:<span class="type">Unit</span>. x:=<span class="number">1</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>self的简单是现实需要动态找到对应的method，更高效的实现当然是对象创建好后method table建好。</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#OCaml" >
    <span class="tag-code">OCaml</span>
  </a>

  <a href="/tags#PL" >
    <span class="tag-code">PL</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2015/03/07/types-and-programming-languages-2.html">
        <span class="nav-arrow">← </span>
        
          Types and Programming Languages (2)
        
      </a>
    
    
      <a class="nav-right" href="/2015/03/01/types-and-programming-languages.html">
        
          Types and Programming Languages (1)
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 二维码 START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.png" height="120" width="120">
      </div>
    
    <!-- 二维码 END -->
    
      <!-- No Comment -->
    

    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="preferred-color-scheme"
      crossorigin="anonymous"
      async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Subtyping"><span class="toc-nav-text">Subtyping</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Ascription-and-Casting"><span class="toc-nav-text">Ascription and Casting</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Case-Study-Imperative-Objects"><span class="toc-nav-text">Case Study: Imperative Objects</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://chenyukang.github.io/2015/03/07/types-and-programming-languages-3.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy; 2021 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        with <a href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'false';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script>
    var _baId = 'ba1315646a61cc7bd6f574a6b5221640';
    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>

<script src="/js/script.js"></script>

  </body>
</html>