<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and writing">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  <meta property="og:site_name" content="程序员的喵">
  <meta property="og:title" content="Types and Programming Languages (1) | 程序员的喵" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content=" http://catcoding.me/css/images/logo.png " />
  <link rel="alternate" type="application/rss+xml" title="程序员的喵; Feed" href="https://catcoding.me/atom.xml" />

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/prism.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">

  
<script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/geopattern.min.js"></script>
<script src="/js/nprogress.min.js"></script>

  
  
  <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
    
    Types and Programming Languages (1) |
    程序员的喵
    
  </title>

  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="/css/images/logo.png" width='400px' height='400px' />
  </div>

  
  


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-77282254-1');
  </script>

<meta name="generator" content="Hexo 5.4.2"></head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>程序员的喵</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      

        <li class="list-item" style="margin: 0">
       <a class="icon-small" href="/search">
        <span class="fa-stack fa-lg">
          <i class="fa fa-search fa-stack-1x fa-inverse" style="color:#8ccb8c"></i>
        </span>
       </a>
      </li>

       <li class="list-item" style="margin-left: 3px">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>

    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Types and Programming Languages (1)</h2>
  <p class="post-date">2015-03-01</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>


<main class="app-body flex-box">

  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>最近掉进另外一个 PL 的坑里面，就是想读一下<a target="_blank" rel="noopener" href="http://www.cis.upenn.edu/~bcpierce/tapl/">这本书</a>，顺便继续熟悉一下 Ocaml。下面的记录是阅读过程中的一些摘录和理解。</p>
<p>1-2 章是数学预备部分，理论部分有些地方比较难懂，主要是一些数学符号看久了眼花。<br>解释器的实现大多只用看 syntax.ml 和 core.ml，就是语法和具体 eval，typeof 函数。</p>
<h4 id="Untyped-Systems"><a href="#Untyped-Systems" class="headerlink" title="Untyped Systems"></a>Untyped Systems</h4><p>arith 是一个无类型的解释器，是后面所有章节的基础。printtm_Term 用了 Format 模块来格式化打印。</p>
<h4 id="The-Untyped-Lambda-Calculus"><a href="#The-Untyped-Lambda-Calculus" class="headerlink" title="The Untyped Lambda-Calculus"></a>The Untyped Lambda-Calculus</h4><p>浅显易懂的 Lambda-Calculus 解释，同时列举了一些 lambda calculus 扩展其他语言部分的例子。</p>
<h4 id="An-ML-Implementation-of-the-Lambda-Calculus"><a href="#An-ML-Implementation-of-the-Lambda-Calculus" class="headerlink" title="An ML Implementation of the Lambda-Calculus"></a>An ML Implementation of the Lambda-Calculus</h4><p>shifting 和 substitution 的实现挺难看懂的，本质上是把 context 里面的变量用 index 来替换，处理变量查找的一种实现而已。eval 部分是非常地简洁，我觉得 ML 系的语法看起来比 Scheme 都舒服紧凑。</p>
<blockquote>
<p>Just because you’ve implemented something doesn’t mean you understand it.<br>​                                                    —Brian Cantwell Smith</p>
</blockquote>
<p>说起来全是泪，用这种函数式的编程语言来解释自己确实比较简单，但现实往往不是这样。语言能比较容易地实现自己至少可以表明语言的内核挺小，一个语言能实现 bootstrap 是成熟的一个表现。Rust 的实现最初是用 Ocaml 写的，然后编译出一个 Rust 的编译器，然后用上一版本的 Rust 再重新实现 Rust 编译器。</p>
<h4 id="Typed-Arithmetic-Expressions"><a href="#Typed-Arithmetic-Expressions" class="headerlink" title="Typed Arithmetic Expressions"></a>Typed Arithmetic Expressions</h4><p>tyarith 是最简单的带类型的解释器，有 bool 和 Nat 类型。</p>
<blockquote>
<p>Progress: A well-typed term is not stuck (either it is a value or it can take a step according to the evaluation rules).<br>Preservation: If a well-typed term takes a step of evaluation, then the resulting term is also well typed</p>
</blockquote>
<p>These properties together tell us that a well-typed term can never reach a stuck state during evaluation.</p>
<blockquote>
<p>Safety = Progress + Preservation</p>
</blockquote>
<h4 id="Simply-Typed-Lambda-Calculus"><a href="#Simply-Typed-Lambda-Calculus" class="headerlink" title="Simply Typed Lambda-Calculus"></a>Simply Typed Lambda-Calculus</h4><blockquote>
<p>In general, languages in which type annotations in terms are used to help guide the typechecker are called explicitly typed. Languages in which we ask the typechecker to infer or reconstruct this information are called implicitly typed.</p>
</blockquote>
<blockquote>
<p> Well-typed programs cannot “go wrong.” —Robin Milner (1978)</p>
</blockquote>
<h4 id="An-ML-Implementation-of-Simple-Types"><a href="#An-ML-Implementation-of-Simple-Types" class="headerlink" title="An ML Implementation of Simple Types"></a>An ML Implementation of Simple Types</h4><p>simplebool 是一个只有 bool 类型的解释器，但是加上了函数。typeof 挺简单，主要是函数这里注意处理形参和实参：</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml"><span class="token operator">|</span> TmAbs<span class="token punctuation">(</span>fi<span class="token punctuation">,</span>x<span class="token punctuation">,</span>tyT1<span class="token punctuation">,</span>t2<span class="token punctuation">)</span> <span class="token operator">-></span>
    <span class="token keyword">let</span> ctx' <span class="token operator">=</span> addbinding ctx x <span class="token punctuation">(</span>VarBind<span class="token punctuation">(</span>tyT1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span>
    <span class="token keyword">let</span> tyT2 <span class="token operator">=</span> typeof ctx' t2 <span class="token keyword">in</span>
    TyArr<span class="token punctuation">(</span>tyT1<span class="token punctuation">,</span> tyT2<span class="token punctuation">)</span>
<span class="token operator">|</span> TmApp<span class="token punctuation">(</span>fi<span class="token punctuation">,</span>t1<span class="token punctuation">,</span>t2<span class="token punctuation">)</span> <span class="token operator">-></span>
    <span class="token keyword">let</span> tyT1 <span class="token operator">=</span> typeof ctx t1 <span class="token keyword">in</span>
    <span class="token keyword">let</span> tyT2 <span class="token operator">=</span> typeof ctx t2 <span class="token keyword">in</span>
    <span class="token punctuation">(</span><span class="token keyword">match</span> tyT1 <span class="token keyword">with</span>
        TyArr<span class="token punctuation">(</span>tyT11<span class="token punctuation">,</span> tyT12<span class="token punctuation">)</span> <span class="token operator">-></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span><span class="token punctuation">)</span> tyT2 tyT11 <span class="token keyword">then</span> tyT12
          <span class="token keyword">else</span> error fi <span class="token string">"parameter type mismatch"</span>
      <span class="token operator">|</span> <span class="token punctuation">_</span> <span class="token operator">-></span> error fi <span class="token string">"arrow type expected"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>if 的判断部分必须为 bool，而且两个分支必须为同一类型：</p>
<pre class="line-numbers language-ocaml" data-language="ocaml"><code class="language-ocaml"><span class="token operator">|</span> TmIf<span class="token punctuation">(</span>fi<span class="token punctuation">,</span>t1<span class="token punctuation">,</span>t2<span class="token punctuation">,</span>t3<span class="token punctuation">)</span> <span class="token operator">-></span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>typeof ctx t1<span class="token punctuation">)</span> TyBool <span class="token keyword">then</span>
     <span class="token keyword">let</span> tyT2 <span class="token operator">=</span> typeof ctx t2 <span class="token keyword">in</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span><span class="token punctuation">)</span> tyT2 <span class="token punctuation">(</span>typeof ctx t3<span class="token punctuation">)</span> <span class="token keyword">then</span> tyT2
     <span class="token keyword">else</span> error fi <span class="token string">"arms of conditional have different types"</span>
     <span class="token keyword">else</span> error fi <span class="token string">"guard of conditional not a boolean"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Simple-Extensions"><a href="#Simple-Extensions" class="headerlink" title="Simple Extensions"></a>Simple Extensions</h4><p>在上一章的基础上，加上各种 Drived Form。</p>
<ul>
<li><p>Sequencing:</p>
<p> 是多个表达式串，这在有副作用的语言里面很常见。另外也可以把 t1;t2 理解为 (λx:Unit.t2) t1。</p>
</li>
<li><p>Wildcards: </p>
<p>如何翻译好，意思就是无用形参可以不指定名字。</p>
</li>
<li><p>Ascription</p>
<p>是指类型缩写 (或者昵名)，C++ 里面的 typedef，和 Rust 里面的 usize as U 都是。这个的好处在于文档和接口更清晰，如果函数的参数可以是函数，类型加进以后语法看起来就比较繁琐了，用类型缩写更清晰。typechecker 的时候当然需要展开来进行。ascription 和 casting 也有一定关系。</p>
<p>增加各种简单的基础类型，比如 String，还有 Pairs，Tuple，Record， Sum，Enum，List。支持一种类型除了一个新类型名字外，其 evaluation rules 和 type rules 也要明确。这里的 datatypes 是按照 Ocaml 的语法来说明的。</p>
<p>因为加上了好多种类型，fullsimple 这个解释器复杂多了。</p>
</li>
</ul>
<h4 id="Type-Dynamic"><a href="#Type-Dynamic" class="headerlink" title="Type Dynamic"></a>Type Dynamic</h4><blockquote>
<p>Even in statically typed languages, there is often the need to deal with data whose type cannot be determined at compile time. This occurs in particular when the lifetime of the data spans multiple machines or many runs of the compiler—when, for example, the data is stored in an external file system or database, or communicated across a network. To handle such situations safely, many languages offer facilities for inspecting the types of values at run time.</p>
</blockquote>
<h4 id="General-Recursion"><a href="#General-Recursion" class="headerlink" title="General Recursion"></a>General Recursion</h4><p>typed lambda-calculus 加上 fix combinator 就是一门极小的但是是 full abstraction 的语言。Ocaml 里面的 letrec 可以用来定义递归函数。fix point 的概念需要继续理解。</p>
</section>

    <p></p>
    <!-- 二维码 START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.jpg" height="160" width="160">
            <figcaption>公号同步更新，欢迎关注👻</figcaption>
      </div>
    

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#OCaml" >
    <span class="tag-code">OCaml</span>
  </a>

  <a href="/tags#PL" >
    <span class="tag-code">PL</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/p/types-and-programming-languages-3/">
        <span class="nav-arrow">← </span>
        
          Types and Programming Lang ...
        
      </a>
    
    
      <a class="nav-right" href="/p/understanding-computation/">
        
          Understanding Computation
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->

    <!-- 二维码 END -->
    
      <!-- No Comment -->
    

    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Untyped-Systems"><span class="toc-nav-text">Untyped Systems</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#The-Untyped-Lambda-Calculus"><span class="toc-nav-text">The Untyped Lambda-Calculus</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#An-ML-Implementation-of-the-Lambda-Calculus"><span class="toc-nav-text">An ML Implementation of the Lambda-Calculus</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Typed-Arithmetic-Expressions"><span class="toc-nav-text">Typed Arithmetic Expressions</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Simply-Typed-Lambda-Calculus"><span class="toc-nav-text">Simply Typed Lambda-Calculus</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#An-ML-Implementation-of-Simple-Types"><span class="toc-nav-text">An ML Implementation of Simple Types</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Simple-Extensions"><span class="toc-nav-text">Simple Extensions</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Type-Dynamic"><span class="toc-nav-text">Type Dynamic</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#General-Recursion"><span class="toc-nav-text">General Recursion</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://catcoding.me/p/types-and-programming-languages/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy;
        2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a> with <a target="_blank" rel="noopener" href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
    </p>
</footer>

<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function(e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("//catcoding.me/js/fastclick.min.js", function() {
        FastClick.attach(document.body);
    })
</script>


<script src="/js/script.js"></script>

  </body>
</html>