<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and writing">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  <meta property="og:site_name" content="程序员的喵">
  <meta property="og:title" content="第 11 期，隐藏的后门；Worse is Better；Wolfram 和 Jobs | 程序员的喵" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content=" http://catcoding.me/css/images/logo.png " />
  <link rel="alternate" type="application/rss+xml" title="程序员的喵; Feed" href="https://catcoding.me/atom.xml" />

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/prism.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">

  
<script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/geopattern.min.js"></script>
<script src="/js/nprogress.min.js"></script>

  
  
  <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
    
    第 11 期，隐藏的后门；Worse is Better；Wolfram 和 Jobs |
    程序员的喵
    
  </title>

  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="/css/images/logo.png" width='400px' height='400px' />
  </div>

  
  


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-77282254-1');
  </script>

<meta name="generator" content="Hexo 5.4.2"></head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>程序员的喵</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      

       <li class="list-item" style="margin-left: 3px">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>

    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>第 11 期，隐藏的后门；Worse is Better；Wolfram 和 Jobs</h2>
  <p class="post-date">2022-05-01</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>


<main class="app-body flex-box">

  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>我每周会分享一下这周看到的好内容，加上自己的一些个人理解和评注。前面三期为：</p>
<p><a href="https://catcoding.me/p/weekly-8/">#8 Valve，另一种公司</a></p>
<p><a href="https://catcoding.me/p/weekly-9/">#9 理想中的开发者</a></p>
<p><a href="https://catcoding.me/p/weekly-10/">#10 下一个 Google；最高形式的财富；冒名顶替综合症</a></p>
<p>这期分享的都是一些经典的老文章，有的老到比我的年纪都大，比如第一篇：</p>
<h2 id="隐藏的后门"><a href="#隐藏的后门" class="headerlink" title="隐藏的后门"></a>隐藏的后门</h2><p><a target="_blank" rel="noopener" href="https://www.ece.cmu.edu/~ganger/712.fall02/papers/p761-thompson.pdf">Reflections on Trusting Trust by Ken Thompson</a></p>
<p><a target="_blank" rel="noopener" href="https://mananshah99.github.io/blog/2020/07/01/trusting-trust/">A Discussion of Ken Thompson’s “Reflections on Trusting Trust”</a></p>
<p>Unix 的缔造者之一 Ken Thompson 在 1983 和 Dennis Ritchie 共同获得了图灵奖，他的的获奖演讲以《Reflections on Trusting Trust》（反思对信任的信任）为题，就是上面那篇短短三页的论文。</p>
<p><img src="/images/ob_pasted-image-20220430114112.png" alt=""></p>
<p>在这篇文章中 Ken Thompson 阐述了一种在编译器里面加上后门的巧妙办法，让他可以登录任何早期的 Unix 系统。</p>
<p>有的人会说编译器里加恶意代码，我们看看编译器的源代码不就知道了么，所以大家通常认为开源软件更安全，毕竟源码面前，毫无秘密。</p>
<p>Ken Thompson 的办法巧妙在于，他先修改了一个编译器的源码，编译出来的编译器为 P0,  P0 可以在另外一份没有后门的编译器源码中插入代码，这样出来的编译器就还是有后门的 P1，但是你看源码又发现不了任何踪迹。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">compile</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token comment">/* If the code we're compiling is code for the Unix login command */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> login_code_pattern<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">compile</span> <span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token comment">/* If the code we're compiling is similar to the compiler source code */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">match</span> <span class="token punctuation">(</span>code<span class="token punctuation">,</span> compiler_code_pattern<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">compile</span> <span class="token punctuation">(</span>compiler_code_with_both_if_statements_inserted<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token comment">/* Do regular compilation things */</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>编译器开发中有个常用的概念是自举 (bootstrapping)，就是用这门语言实现的编译器编译新版本的编译器源码，一门新的编译型编程语言，实现自举是第一个里程碑。</p>
<p>这里就牵涉到<strong>鸡生蛋还是蛋生鸡</strong>的问题，那第一个编译器肯定不是自身语言实现的，比如 C 第一个编译器是 B 语言写的， Rust 编译器的第一份源码是 OCaml 的。</p>
<p>Ken Thompson 的做法可以理解为在自举过程中加入了特定的后门逻辑，导致编译出来的编译器都会有问题。</p>
<p>这里有位作者在 Go 编译器上做了 PoC，<a target="_blank" rel="noopener" href="https://ekyu.moe/article/thompson-hack-on-golang/">为编译器植入隐藏后门——亲手实践 Thompson hack</a>。</p>
<p>这类安全问题可以统称为信任链攻击，使用这种攻击手法，越底层的软件被动了手脚危害越大。一个 <code>npm install</code> 下去可能几百个第三方包就安装了，之前也出现过在 npm 包里加入挖矿代码这样的事。</p>
<p>现在软件开发的依赖如此错综复杂，我们只能相信写代码的人了。</p>
<h2 id="Worse-is-Better"><a href="#Worse-is-Better" class="headerlink" title="Worse is Better"></a>Worse is Better</h2><p><a target="_blank" rel="noopener" href="https://dreamsongs.com/RiseOfWorseIsBetter.html">Rise of Worse Is Better</a></p>
<p>这篇文章是 1991 年写的，可以说影响了好几代程序员。我在学校的时候也读到过，这次重读一遍。</p>
<p>一个好的、理论上正确的设计包含这几点：</p>
<ol>
<li>简单性</li>
<li>正确性</li>
<li>一致性</li>
<li>完整性</li>
</ol>
<p>实践中采用这种设计哲学的方式称作 MIT 方式，在这种方式下设计的是 Lisp 和 Lisp Machine(一种专门跑 Lisp 的硬件)。</p>
<p>而 <strong>worse is better</strong> 的哲学认为简单性是最重要的，但为了保持简单可以一定程度上牺牲其他三个特性，这称之为  New Jersey 方式。这种方式下实现的产物是 C 和 Unix。</p>
<p>为什么称为 New Jersey 方式 ? </p>
<p>因为 C/Unix 的创造者 Dennis Ritchie 和  Thompson 所在的学校 UC Berkeley 在 New Jersey，另外美国人喜欢调侃新泽西，觉得相比起附近高贵的纽约，这地方真是又土又穷。新泽西乡巴佬，赤裸裸的地域歧视和小讽刺啊！</p>
<p>这篇文章中的主要例子是一个操作系统中的  <code>PC loser-ing</code> 问题，我看的时候没太看懂，然后搜到了这篇文章 <a target="_blank" rel="noopener" href="https://blog.reverberate.org/2011/04/eintr-and-pc-loser-ing-is-better-case.html">EINTR and PC loser-ing , The “Worse Is Better” case study</a>。这篇文章的推测我认为是对的，早期的 Unix 系统调用有一个 EINTR 返回状态 (被中断的系统调用)，表示系统调用过程中发生了中断，需要重试，所以调用的时候经常写这种代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">again<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> BUFFSIZE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>errno <span class="token operator">==</span> EINTR<span class="token punctuation">)</span>
      <span class="token keyword">goto</span> again<span class="token punctuation">;</span>  <span class="token comment">/* just an interrupted system call */</span>
    <span class="token comment">/* handle other errors */</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这看起来确实够丑陋的，不过因为几乎所有的开发者默认都想重试，所以  4.2BSD 开始就已经支持自动重试，而 POSIX API 通过修改 <code>struct sigaction</code> 的  <code>SA_RESTART</code> 参数来决定是否重试。</p>
<p>所以，Unix 系统调用接口虽然当时看起来丑陋，但是逐渐已经通过缝缝补补把这个问题解决了！</p>
<blockquote>
<p> In other words, Berkeley UNIX was already doing “the right thing” five years before “Worse is Better” was written!</p>
</blockquote>
<p>而 Lisp Machine 对比 Unix，虽然设计精美、统一，但是却迅速陨落了。在软件开发中，这种新泽西方法似乎更有生命力，简单而言就是小步快跑，实现简单，快速出活。 Unix 就是这样，虽然理论上看起来不够优雅，但是足够简单，可以很快地移植到不同的硬件上去，所以越来越流行：</p>
<blockquote>
<p>The worse-is-better philosophy means that implementation simplicity has highest priority, which means Unix and C are easy to port on such machines. Therefore, one expects that if the 50% functionality Unix and C support is satisfactory, they will start to appear everywhere. And they have, haven’t they? Unix and C are the ultimate computer viruses.</p>
</blockquote>
<blockquote>
<p>The lesson to be learned from this is that it is often undesirable to go for the right thing first. It is better to get half of the right thing available so that it spreads like a virus. Once people are hooked on it, take the time to improve it to 90% of the right thing.</p>
</blockquote>
<p>这和另外一个软件开发箴言是一个意思：</p>
<blockquote>
<p>Make it work, make it right, make it fast<br>– Kent Beck.</p>
</blockquote>
<p>而 Lisp 本身虽然已经没落，但一些核心的东西却深刻地改变了编程语言和软件开发，比如递归、函数式编程、GC、Eval、Code as Data 等等，参考 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2010/10/why_lisp_is_superior.html">为什么 Lisp 语言如此先进</a>。</p>
<h2 id="Wolfram-和-Jobs"><a href="#Wolfram-和-Jobs" class="headerlink" title="Wolfram 和 Jobs"></a>Wolfram 和 Jobs</h2><p><a target="_blank" rel="noopener" href="https://twitter.com/stephen_wolfram/status/1517589051552972806">Stephen Wolfram on Twitter</a></p>
<p><img src="/images/ob_pasted-image-20220430143425.png" alt=""></p>
<p>Wolfram 是著名软件 Mathematica 的作者，在这封 1987 年的信件里面他回复了 Jobs 的咨询。这个文件里面倒是没有列出 Jobs 的原问题，不过从标题和回复内容看，大概是 Jobs 想在 NeXT 里面做一个叫作 jobsbooks 的东西，里面包含一些词典、手册、等常用的书籍和参考，所以向 Wolfram 咨询数据来源有哪些？</p>
<p>当然这是我的猜测，Wolfram 是很适合问这个问题的人，他几乎是一个百科全书式的天才。他年轻的时候开始做物理方面的研究，后来开始写软件：</p>
<blockquote>
<p>“我一直认为，做研究一定要用最好的工具。即使我用的是当时最先进的计算机，还是不断遇到故障。我明白，唯一的方法就是自己把它们造出来。所以，我就动手了。”</p>
</blockquote>
<p>于是 Mathematica 诞生了，这个软件被称作是“有史以来最重要的科学软件”。</p>
<p>我搜索后发现 Wolfram 和 Jobs 也就是在 1985 年左右结识的，这篇文章是 Wolfram 2011 年 Jobs 去世时写的 <a target="_blank" rel="noopener" href="https://writings.stephenwolfram.com/2011/10/steve-jobs-a-few-memories/">Steve Jobs: A Few Memories—Stephen Wolfram Writings</a>。</p>
<p>里面写到了多年前的往事，甚至 Mathematica 这个软件的名字是 Jobs 给取的。其中有段还写到，一次交谈时 Jobs 心烦意乱、小鹿乱撞，原来他晚上有个约会：</p>
<blockquote>
<p>The Steve Jobs—so confident as a businessman and technologist—had melted away, and he was asking me—hardly a noted known authority on such things—about his date.</p>
</blockquote>
<p>但 Wolfram 肯定比 Jobs 更“书呆”，怎么可能给出约会的建议，哈哈。</p>
<hr>
<p>这些老文看起来也挺有趣！</p>
<p>各位劳动节快乐！</p>
</section>

    <p></p>
    <!-- 二维码 START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.jpg" height="160" width="160">
            <figcaption>公号同步更新，欢迎关注👻</figcaption>
      </div>
    

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#技术" >
    <span class="tag-code">技术</span>
  </a>

  <a href="/tags#写作" >
    <span class="tag-code">写作</span>
  </a>

  <a href="/tags#周刊" >
    <span class="tag-code">周刊</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
    
      <a class="nav-right" href="/p/anxiety-handbook/">
        
          焦虑自救小册
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->

    <!-- 二维码 END -->
    
      <!-- No Comment -->
    

    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E9%9A%90%E8%97%8F%E7%9A%84%E5%90%8E%E9%97%A8"><span class="toc-nav-text">隐藏的后门</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Worse-is-Better"><span class="toc-nav-text">Worse is Better</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Wolfram-%E5%92%8C-Jobs"><span class="toc-nav-text">Wolfram 和 Jobs</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://catcoding.me/p/weekly-11/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy;
        2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a> with <a target="_blank" rel="noopener" href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
    </p>
</footer>

<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function(e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("//catcoding.me/js/fastclick.min.js", function() {
        FastClick.attach(document.body);
    })
</script>


<script src="/js/script.js"></script>

  </body>
</html>