<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yukang&#39;s Page</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://cyukang.com/"/>
  <updated>2018-03-05T15:31:26.122Z</updated>
  <id>http://cyukang.com/</id>
  
  <author>
    <name>Yukang</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Kongé›†ç¾¤Left Cluster Nodeé—®é¢˜</title>
    <link href="http://cyukang.com/2018/03/04/kong-cluster-left-node.html"/>
    <id>http://cyukang.com/2018/03/04/kong-cluster-left-node.html</id>
    <published>2018-03-04T03:02:32.000Z</published>
    <updated>2018-03-05T15:31:26.122Z</updated>
    
    <content type="html"><![CDATA[<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>Kongåœ¨å®è·µä¸­ä¼šæœ‰ä¸€äº›ç–‘æƒ‘çš„åœ°æ–¹ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚æ³¨æ„è¿™é‡Œè®°å½•çš„Kongé›†ç¾¤éƒ¨ç½²çš„é—®é¢˜æ˜¯0.10.3ç‰ˆæœ¬çš„ï¼Œæœ€æ–°Kongç‰ˆæœ¬å·²ç»ä¸æ˜¯é€šè¿‡serfæ¥ç®¡ç†ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„é…ç½®åŒæ­¥é—®é¢˜ã€‚</p>
<p>åœ¨Kongå¤šèŠ‚ç‚¹éƒ¨ç½²çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™æŸä¸ªèŠ‚ç‚¹åœæ‰åï¼Œæˆ‘ä»¬åœ¨åå°å¯ä»¥çœ‹åˆ°leftçš„ä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸ªleftä¿¡æ¯ä¼šä¿ç•™ä¸€æ®µä¸çŸ­çš„æ—¶é—´ã€‚ç±»ä¼¼äºå¦‚ä¸‹ï¼š </p>
<p><img src="/images/kong-left-0133521.png" alt="kong-left"></p>
<h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>ç®¡ç†åå°Kongaæ˜¯é€šè¿‡apiè·å–çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œåœ¨<code>kong/kong/api/routes/cluster.lua</code>æ–‡ä»¶é‡Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹è·¯ç”±å¤„ç†é€»è¾‘ï¼š </p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line">GET = <span class="function"><span class="keyword">function</span><span class="params">(self, dao_factory, helpers)</span></span></div><div class="line">  <span class="keyword">local</span> members, err = singletons.serf:members()</div><div class="line">  <span class="keyword">if</span> err <span class="keyword">then</span></div><div class="line">    <span class="keyword">return</span> responses.send_HTTP_INTERNAL_SERVER_ERROR(err)</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="keyword">local</span> result = &#123;data = &#123;&#125;&#125;</div><div class="line">  <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">pairs</span>(members) <span class="keyword">do</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.params.<span class="built_in">status</span> <span class="keyword">or</span> (self.params.<span class="built_in">status</span> <span class="keyword">and</span> v.<span class="built_in">status</span> == self.params.<span class="built_in">status</span>) <span class="keyword">then</span></div><div class="line">      table_insert(result.data, &#123;</div><div class="line">        name = v.name,</div><div class="line">        address = v.addr,</div><div class="line">        <span class="built_in">status</span> = v.<span class="built_in">status</span></div><div class="line">      &#125;)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  result.total = #result.data</div><div class="line">  <span class="keyword">return</span> responses.send_HTTP_OK(result)</div><div class="line"><span class="keyword">end</span>,</div></pre></td></tr></table></figure>
<p>å…·ä½“<code>serf:members()</code>çš„å®ç°åœ¨serf.luaé‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯æ‰§è¡Œäº†<code>serf cluster members</code>å‘½ä»¤è·å–ç»“æœç„¶åè¿”å›JSONã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤å…¶å®ä¹Ÿå¯ä»¥çœ‹åˆ°ç±»ä¼¼çš„ç»“æœï¼š </p>
<p><img src="/images/kong-left-cmd.png" alt="kong-left-cmd"></p>
<p>é‚£ä¹ˆé—®é¢˜çš„æ ¹æºå½“ç„¶æ˜¯åœ¨Serfæœ¬èº«é‡Œé¢ï¼Œé€šè¿‡çœ‹æ–‡æ¡£å‘ç°åŸæ¥ç¡®å®æ˜¯æœ‰ä¸€å®šå»¶è¿Ÿçš„ã€‚</p>
<blockquote>
<p>Serf keeps the state of dead nodes around for a set amount of time, so that when full syncs are requested, the requester also receives information about dead nodes. Because SWIM doesnâ€™t do full syncs, SWIM deletes dead node state immediately upon learning that the node is dead. This change again helps the cluster converge more quickly.</p>
<p><a href="https://www.serf.io/docs/internals/gossip.html#lifeguard-enhancements" target="_blank" rel="external">å‚è€ƒserfæ–‡æ¡£Â»</a></p>
</blockquote>
<h4 id="serfçš„å…·ä½“å®ç°"><a href="#serfçš„å…·ä½“å®ç°" class="headerlink" title="serfçš„å…·ä½“å®ç°"></a>serfçš„å…·ä½“å®ç°</h4><p>æ¥ç€ç¨å¾®çœ‹äº†ä¸€ä¸‹Serfçš„ä»£ç ï¼Œæœç„¶Goçš„é¡¹ç›®ä»£ç ç›´è§‚å¥½è¯»ã€‚åœ¨Serfè¿™ä¸ªç»“æ„ä½“é‡Œé¢ä¿å­˜äº†ä¸€ä¸ªleftMembersçš„çŠ¶æ€åˆ—è¡¨ï¼Œæ¯æ¬¡æ”¶åˆ°leftäº‹ä»¶çš„æ—¶å€™å¤„ç†é€»è¾‘æ˜¯ï¼š </p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// handleNodeLeaveIntent is called when an intent to leave is received.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Serf)</span> <span class="title">handleNodeLeaveIntent</span><span class="params">(leaveMsg *messageLeave)</span> <span class="title">bool</span></span> &#123;</div><div class="line">	..................</div><div class="line">    </div><div class="line">	<span class="comment">// State transition depends on current state</span></div><div class="line">	<span class="keyword">switch</span> member.Status &#123;</div><div class="line">	<span class="keyword">case</span> StatusAlive:</div><div class="line">		member.Status = StatusLeaving</div><div class="line">		member.statusLTime = leaveMsg.LTime</div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span></div><div class="line">	<span class="keyword">case</span> StatusFailed:</div><div class="line">		member.Status = StatusLeft</div><div class="line">		member.statusLTime = leaveMsg.LTime</div><div class="line"></div><div class="line">		<span class="comment">// Remove from the failed list and add to the left list. We add</span></div><div class="line">		<span class="comment">// to the left list so that when we do a sync, other nodes will</span></div><div class="line">		<span class="comment">// remove it from their failed list.</span></div><div class="line">		s.failedMembers = removeOldMember(s.failedMembers, member.Name)</div><div class="line">		s.leftMembers = <span class="built_in">append</span>(s.leftMembers, member)</div><div class="line">        </div><div class="line">        ................</div><div class="line">        </div><div class="line">		<span class="keyword">return</span> <span class="literal">true</span></div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="keyword">return</span> <span class="literal">false</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é€šè¿‡ç´¢å¼•å˜é‡å‘ç°è¿™ä¸ªåˆ—è¡¨ä¼šå®šæ—¶é€šè¿‡<code>handleReap</code>å‡½æ•°æ›´æ–°ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š </p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// handleReap periodically reaps the list of failed and left members, as well</span></div><div class="line"><span class="comment">// as old buffered intents.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Serf)</span> <span class="title">handleReap</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">for</span> &#123;</div><div class="line">		<span class="keyword">select</span> &#123;</div><div class="line">		<span class="keyword">case</span> &lt;-time.After(s.config.ReapInterval):</div><div class="line">			s.memberLock.Lock()</div><div class="line">			now := time.Now()</div><div class="line">			s.failedMembers = s.reap(s.failedMembers, now, s.config.ReconnectTimeout)</div><div class="line">			s.leftMembers = s.reap(s.leftMembers, now, s.config.TombstoneTimeout)</div><div class="line">			reapIntents(s.recentIntents, now, s.config.RecentIntentTimeout)</div><div class="line">			s.memberLock.Unlock()</div><div class="line">		<span class="keyword">case</span> &lt;-s.shutdownCh:</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ‰€ä»¥çœ‹èµ·æ¥è¿™é‡Œç›¸å…³çš„Timeoutæ˜¯<code>s.config.TombstoneTimeout</code>, æ¥ç€éœ€è¦çœ‹çœ‹<code>reap</code>åˆ°åº•åšäº†ä»€ä¹ˆï¼Œè¿™é‡Œæœç„¶æ˜¯æŠŠåˆ°äº†ä¸€å®šæ—¶é—´é—´éš”çš„èŠ‚ç‚¹åˆ æ‰äº†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line"><span class="comment">// reap is called with a list of old members and a timeout, and removes</span></div><div class="line"><span class="comment">// members that have exceeded the timeout. The members are removed from</span></div><div class="line"><span class="comment">// both the old list and the members itself. Locking is left to the caller.</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Serf)</span> <span class="title">reap</span><span class="params">(old []*memberState, now time.Time, timeout time.Duration)</span> []*<span class="title">memberState</span></span> &#123;</div><div class="line">	n := <span class="built_in">len</span>(old)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; n; i++ &#123;</div><div class="line">		m := old[i]</div><div class="line"></div><div class="line">		<span class="comment">// Skip if the timeout is not yet reached</span></div><div class="line">		<span class="keyword">if</span> now.Sub(m.leaveTime) &lt;= timeout &#123;</div><div class="line">			<span class="keyword">continue</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Delete from the list</span></div><div class="line">		old[i], old[n<span class="number">-1</span>] = old[n<span class="number">-1</span>], <span class="literal">nil</span></div><div class="line">		old = old[:n<span class="number">-1</span>]</div><div class="line">		n--</div><div class="line">		i--</div><div class="line"></div><div class="line">		..........</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> old</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆè¿™ä¸ªæ—¶é—´é—´éš”æ˜¯å¤šä¹…å‘¢ï¼Œåœ¨<code>serf/config.go</code>æœ‰ä¸€ä¸ªé»˜è®¤é…ç½®ï¼š </p>
<figure class="highlight go"><table><tr><td class="code"><pre><div class="line">TombstoneTimeout:             <span class="number">24</span> * time.Hour,</div></pre></td></tr></table></figure>
<h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><p>serfè¿™ä¸ªè½¯ä»¶å€¼å¾—å¥½å¥½åˆ†æä¸€ä¸‹ï¼ŒèŠ‚ç‚¹çš„çŠ¶æ€åŒæ­¥å’Œäº‹ä»¶å¤„ç†éƒ½æ˜¯åˆ†å¸ƒå¼è½¯ä»¶çš„åŸºç¡€ï¼Œåç»­ç»§ç»­çœ‹çœ‹è¿™ä¸ª<code>gossip protocol based on SWIM</code>çš„å…·ä½“å®ç°ã€‚å¦å¤–<a href="https://www.hashicorp.com/" target="_blank" rel="external">hashicorp</a>è¿™ä¸ªå…¬å¸çš„å¼€æºä»£ç å’Œæ–‡æ¡£éƒ½éå¸¸å¥½ï¼Œå€¼å¾—å­¦ä¹ ä¸€ç•ªã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h4&gt;&lt;p&gt;Kongåœ¨å®è·µä¸­ä¼šæœ‰ä¸€äº›ç–‘æƒ‘çš„åœ°æ–¹ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚æ³¨æ„è¿™é‡Œè®°å½•çš„Kongé›†ç¾¤éƒ¨ç½²çš„é—®é¢˜æ˜¯0.10.3ç‰ˆæœ¬çš„ï¼Œæœ€æ–°Kongç‰ˆæœ¬å·²ç»ä¸æ˜¯é€šè¿‡se
    
    </summary>
    
    
      <category term="Tools" scheme="http://cyukang.com/tags/Tools/"/>
    
      <category term="Kong" scheme="http://cyukang.com/tags/Kong/"/>
    
      <category term="Golang" scheme="http://cyukang.com/tags/Golang/"/>
    
  </entry>
  
  <entry>
    <title>Docker composeåˆå§‹åŒ–å¤±è´¥é—®é¢˜</title>
    <link href="http://cyukang.com/2018/03/02/docker-postgres-password.html"/>
    <id>http://cyukang.com/2018/03/02/docker-postgres-password.html</id>
    <published>2018-03-02T15:17:35.000Z</published>
    <updated>2018-03-05T15:32:20.679Z</updated>
    
    <content type="html"><![CDATA[<h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>ä»Šå¤©åœ¨Docker Postgresqlç”¨æˆ·åå’Œå¯†ç æˆæƒçš„é—®é¢˜ä¸ŠèŠ±äº†ä¸€äº›æ—¶é—´ï¼Œé—®é¢˜æ˜¯ï¼š </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line">psql: FATAL:  password authentication failed for user "postgres"</div></pre></td></tr></table></figure>
<p>adminçš„ç”¨æˆ·åå’Œå¯†ç æ˜¯å¯ä»¥åœ¨docker-compose.ymlé‡Œè®¾ç½®çš„ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥é…ç½®ä¸ºï¼š </p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">postgresql:</span></div><div class="line"><span class="attr">  image:</span> <span class="attr">postgres:latest</span></div><div class="line"><span class="attr">  ports:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">"5434:5432"</span></div><div class="line"><span class="attr">  volumes:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">./data/pgsql:/var/lib/postgresql/data</span></div><div class="line"><span class="bullet">    -</span> <span class="string">./initialize/pgsql:/docker-entrypoint-initdb.d</span></div><div class="line"><span class="attr">  environment:</span></div><div class="line"><span class="attr">    POSTGRES_USER:</span> <span class="string">postgres</span></div><div class="line"><span class="attr">    POSTGRES_DB:</span> <span class="string">postgres</span></div><div class="line"><span class="attr">  secrets:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">pg_superuser_password</span></div></pre></td></tr></table></figure>
<p>æŸä¸ªç”¨æˆ·çš„å¯†ç å¯ä»¥åœ¨<code>./initialize/pgsql</code>ç›®å½•çš„è„šæœ¬é‡Œè®¾ç½®ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">#</span>!/bin/bash</div><div class="line">set -e</div><div class="line"></div><div class="line">psql -v ON_ERROR_STOP=1 --username "postgres" &lt;&lt;-EOSQL</div><div class="line">	CREATE USER user WITH PASSWORD 'the-password';</div><div class="line">	ALTER USER user CREATEDB;</div><div class="line">EOSQL</div></pre></td></tr></table></figure>
<p>åªæ˜¯ä»Šå¤©ç¢°å·§æƒ³ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªå¯†ç ï¼Œæ‰€ä»¥å°±æŠŠè¿™ä¸ªè„šæœ¬é‡Œçš„å¯†ç ä¿®æ”¹äº†ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line">docker-compose up --build -d --force-recreate</div></pre></td></tr></table></figure>
<p>è€Œåå°±ä¸€ç›´å‡ºç°ä¸Šé¢çš„ç”¨æˆ·æˆæƒå¤±è´¥ã€‚</p>
<h4 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h4><p>åˆšå¼€å§‹ä¸€ç›´è®¤ä¸ºæ˜¯å¯èƒ½dockerfileé…ç½®å¾—ä¸å¯¹ï¼Œç»“æœèŠ±è´¹äº†äº›æ—¶é—´ã€‚åæ¥çªç„¶æƒ³åˆ°äº†ï¼ŒPGé‡Œæ•°æ®åˆå§‹åŒ–åº”è¯¥åªæ˜¯ç¬¬ä¸€æ¬¡åšäº†ï¼Œåç»­å¦‚æœå‘ç°<code>/var/lib/postgresql/data</code>é‡Œå·²ç»æœ‰æ•°æ®äº†å°±å†ä¹Ÿä¸ä¼šé‡æ–°è®¾ç½®å¯†ç ï¼Œè¿™é‡Œæ˜¯é…ç½®volumeçš„ï¼Œå¦‚æœè¿˜æœªæœ‰é‡è¦æ•°æ®æŠŠ<code>./data/pgsql</code>åˆ é™¤äº†å³å¯ï¼Œæˆ–è€…åº”è¯¥æ˜¯å¯ä»¥é€šè¿‡attachè¿›å…¥å®¹å™¨é€šè¿‡pgå‘½ä»¤ä¿®æ”¹ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€è¿‘åœ¨è‡ªå·±å·¥ä½œçš„é¡¹ç›®éƒ½å®Œå…¨DockeråŒ–ï¼Œæ„Ÿè§‰æ˜¯é…ç½®æ¥æŠ˜è…¾ç”¨èµ·æ¥é£ã€‚æœ€è¿‘ä¹Ÿåœ¨åšä¸€ä¸ªé‡åº¦ä¾èµ–Dockerçš„é¡¹ç›®ï¼Œæ‰€ä»¥Dockerçš„æ–‡æ¡£éœ€è¦çœ‹å®Œï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œå’Œæ•°æ®å­˜å‚¨é‚£å—ï¼Œå¦åˆ™ä¼šèŠ±è´¹ä¸å°‘æ—¶é—´æŠ˜è…¾ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h4&gt;&lt;p&gt;ä»Šå¤©åœ¨Docker Postgresqlç”¨æˆ·åå’Œå¯†ç æˆæƒçš„é—®é¢˜ä¸ŠèŠ±äº†ä¸€äº›æ—¶é—´ï¼Œé—®é¢˜æ˜¯ï¼š &lt;/p&gt;
&lt;figure class=&quot;highli
    
    </summary>
    
    
      <category term="Tools" scheme="http://cyukang.com/tags/Tools/"/>
    
      <category term="Docker" scheme="http://cyukang.com/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨overcommitç”Ÿæˆgit hooks</title>
    <link href="http://cyukang.com/2018/02/26/overcommit.html"/>
    <id>http://cyukang.com/2018/02/26/overcommit.html</id>
    <published>2018-02-26T11:02:14.000Z</published>
    <updated>2018-03-05T15:31:26.122Z</updated>
    
    <content type="html"><![CDATA[<p><code>git hooks</code>å¾ˆæ–¹ä¾¿åœ°å¯ä»¥åœ¨gitæ“ä½œæµç¨‹çš„å„ä¸ªé˜¶æ®µåŠ å…¥hooksï¼Œæ¯”å¦‚æ‰§è¡Œä¸€äº›è„šæœ¬æ¥æ£€æŸ¥ä»£ç é£æ ¼ã€è·‘å•å…ƒæµ‹è¯•ã€åšä»£ç é™æ€æ£€æŸ¥ç­‰ã€‚git hooksçš„è¯•ç”¨æ–¹æ³•æ˜¯åœ¨.git/hooksç›®å½•ä¸‹å†™å„ç§è„šæœ¬ï¼Œä½†æ˜¯.gitç›®å½•çš„è¿™äº›è„šæœ¬æ˜¯ä¸ä¼šcheckinåˆ°repoé‡Œçš„ï¼Œæ‰€ä»¥å¦‚æœä¸€ä¸ªä»£ç å¦‚æœè¢«å¤šä¸ªå¼€å‘äººå‘˜å…±äº«å°±ä¼šæ˜¾å¾—ä¸å¤ªæ–¹ä¾¿åŒæ­¥hooksã€‚</p>
<p><a href="https://stackoverflow.com/questions/427207/can-git-hook-scripts-be-managed-along-with-the-repository" target="_blank" rel="external">å½“ç„¶ä¹Ÿæœ‰ä¸€äº›å…¶ä»–æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜</a>ï¼Œæ¯”å¦‚é…ç½®linksæˆ–è€…å¯¹äº<code>git 2.9</code>ä»¥åä¹Ÿå¯ä»¥ä½¿ç”¨æ¥å®šåˆ¶hooksçš„ç›®å½•:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line">git config core.hooksPath hooks</div></pre></td></tr></table></figure>
<p>å¯¹äºç†Ÿæ‚‰Rubyçš„åŒå­¦å¯ä»¥ä½¿ç”¨<a href="https://github.com/brigade/overcommit" target="_blank" rel="external">overcommit</a>è¿™ä¸ªgemæ¥è§£å†³ã€‚ä½¿ç”¨æ–¹æ³•å°±æ˜¯é€šè¿‡é…ç½®<code>.overcommit.yml</code>ï¼Œæ¯”å¦‚:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><div class="line"><span class="attr">PreCommit:</span></div><div class="line"><span class="attr">  RuboCop:</span></div><div class="line"><span class="attr">    enabled:</span> <span class="literal">true</span></div><div class="line"><span class="attr">    command:</span> <span class="string">['bundle',</span> <span class="string">'exec'</span><span class="string">,</span> <span class="string">'rubocop'</span><span class="string">]</span> <span class="comment">#  The shell command should run</span></div><div class="line"></div><div class="line"><span class="attr">  AuthorName:</span></div><div class="line"><span class="attr">    enabled:</span> <span class="literal">false</span></div></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œå‘½ä»¤:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line">overcommit install</div></pre></td></tr></table></figure>
<p>æ¥è‡ªåŠ¨ç”Ÿæˆå„ç§hooksï¼Œé€šå¸¸åé¢çš„ä¿®æ”¹éƒ½æ˜¯ä¿®æ”¹è¿™ä¸ªyamlæ–‡ä»¶å³å¯ï¼Œä¸è¿‡è®°å¾—ä¿®æ”¹åéœ€è¦<code>overcommit --signed</code>æ¥é‡æ–°ç”Ÿæˆhooksã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;git hooks&lt;/code&gt;å¾ˆæ–¹ä¾¿åœ°å¯ä»¥åœ¨gitæ“ä½œæµç¨‹çš„å„ä¸ªé˜¶æ®µåŠ å…¥hooksï¼Œæ¯”å¦‚æ‰§è¡Œä¸€äº›è„šæœ¬æ¥æ£€æŸ¥ä»£ç é£æ ¼ã€è·‘å•å…ƒæµ‹è¯•ã€åšä»£ç é™æ€æ£€æŸ¥ç­‰ã€‚git hooksçš„è¯•ç”¨æ–¹æ³•æ˜¯åœ¨.git/hooksç›®å½•ä¸‹å†™å„ç§è„šæœ¬ï¼Œä½†æ˜¯.gitç›®å½•çš„è¿™äº›è„šæœ¬æ˜¯ä¸ä¼šchecki
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Nginx https too many redirect</title>
    <link href="http://cyukang.com/2018/02/23/nginx-https-too-many-redirect.html"/>
    <id>http://cyukang.com/2018/02/23/nginx-https-too-many-redirect.html</id>
    <published>2018-02-23T09:38:44.000Z</published>
    <updated>2018-02-23T14:02:50.419Z</updated>
    
    <content type="html"><![CDATA[<p>Httpè¯·æ±‚åœ¨ç»è¿‡å¤šå±‚Nginxçš„æ—¶å€™ï¼Œé€šå¸¸å¼ºåˆ¶httpè·³è½¬åˆ°httpsçš„æ—¶å€™ä¼šè¿™æ ·é…ç½®: </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">return</span> <span class="number">302</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>; </div><div class="line"><span class="comment">## éœ€è¦æ³¨æ„è¿™é‡Œæ˜¯request_uriè€Œä¸æ˜¯uriï¼Œå¦åˆ™ä¼šå¼•èµ·å®‰å…¨é—®é¢˜</span></div></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¦‚æœæ˜¯å¤šå±‚Nginxï¼Œå‰é¢çš„Nginxéœ€è¦æŠŠç”¨æˆ·åŸå§‹è¯·æ±‚çš„schemeä¼ é€’åˆ°åç«¯ï¼Œå¯ä»¥åŠ ä¸Šå¤´éƒ¨è®¾ç½®ï¼š </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</div></pre></td></tr></table></figure>
<p>åé¢çš„Nginxå†åˆ¤æ–­ä¸€æ¬¡:</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">if</span> ( <span class="variable">$http_x_forwarded_proto</span> != <span class="string">'https'</span> ) &#123;</div><div class="line">  <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$host</span><span class="variable">$request_uri</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦åˆ™å¼ºåˆ¶httpsç»å¸¸ä¼šå‡ºç°ç±»ä¼¼<code>ERR_TOO_MANY_REDIRECTS å°†æ‚¨é‡å®šå‘çš„æ¬¡æ•°è¿‡å¤š</code>è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p>å¯æ˜¯åœ¨å®è·µè¿‡ç¨‹ä¸­å¶å°”ä¹Ÿç¢°åˆ°è¿‡ä¸€äº›ELBä¼šä¸¢æ‰schemeçš„é—®é¢˜ï¼Œæ¯”å¦‚åœ¨è¿™æ ·çš„è¯·æ±‚é“¾è·¯æƒ…å†µä¸‹<code>elb =&gt; nginx =&gt; nginx =&gt; application</code>ç¬¬äºŒå±‚Nginxè·å–çš„schemeå°±æœ‰é—®é¢˜äº†ï¼Œè¿™ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´<code>too many redirects</code>é—®é¢˜ã€‚</p>
<p>å¯ä»¥å°è¯•åœ¨ç¬¬äºŒå±‚Nginxä¸Šè¿™æ ·è§£å†³ï¼š </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><div class="line"><span class="attribute">proxy_set_header</span>   X-Forwarded-Proto <span class="variable">$http_x_forwarded_proto</span>;</div></pre></td></tr></table></figure>
<p>å½“ç„¶å¼ºåˆ¶httpsè¿™æ ·çš„è·³è½¬é€»è¾‘å°½é‡æ”¾åœ¨è¯·æ±‚é“¾è·¯çš„æœ€å¤–å±‚ï¼Œè¿™æ ·é—®é¢˜ä¼šå°‘ä¸€äº›ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Httpè¯·æ±‚åœ¨ç»è¿‡å¤šå±‚Nginxçš„æ—¶å€™ï¼Œé€šå¸¸å¼ºåˆ¶httpè·³è½¬åˆ°httpsçš„æ—¶å€™ä¼šè¿™æ ·é…ç½®: &lt;/p&gt;
&lt;figure class=&quot;highlight nginx&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;sp
    
    </summary>
    
    
      <category term="Nginx" scheme="http://cyukang.com/tags/Nginx/"/>
    
  </entry>
  
  <entry>
    <title>Linux å½“å‰ shell æ‰§è¡Œå‘½ä»¤</title>
    <link href="http://cyukang.com/2018/02/22/linux-source.html"/>
    <id>http://cyukang.com/2018/02/22/linux-source.html</id>
    <published>2018-02-22T13:46:33.000Z</published>
    <updated>2018-02-22T17:29:42.519Z</updated>
    
    <content type="html"><![CDATA[<p>Linux shell æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ä¸€èˆ¬æ˜¯ä¼š fork å‡ºä¸€ä¸ªå­ shellï¼Œè¿™æ ·åœ¨æœ‰çš„æ—¶å€™å°±ä¸æ–¹ä¾¿äº†ï¼Œæ¯”å¦‚è¦unset å½“å‰shell çš„ç¯å¢ƒå˜é‡ç­‰ï¼Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">!/usr/bin/env zsh</span></div><div class="line"></div><div class="line">if [ -z $http_proxy ]; then</div><div class="line">    echo "not using proxy, set it now ... ";</div><div class="line">    export http_proxy="http://127.0.0.1:1087";</div><div class="line">    export https_proxy="https://127.0.0.1:1087";</div><div class="line">    echo $http_proxy;</div><div class="line">else</div><div class="line">    echo "using proxy now, unset it now ...";</div><div class="line">    unset http_proxy;</div><div class="line">    unset https_proxy;</div><div class="line">    echo $http_proxy;</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>è¿™æ—¶å€™éœ€è¦æ‰§è¡Œ <code>. ./proxy_toggle.sh</code> æˆ–è€… <code>source ./proxy_toggle.sh</code>ã€‚</p>
<p><code>.</code> (a period) is a <a href="http://www.gnu.org/software/bash/manual/bashref.html#Bourne-Shell-Builtins" target="_blank" rel="external">bash shell built-in command</a> that executes the commands from a file passed as argument, in the current shell. <code>source</code> is a synonym for <code>.</code></p>
<p>From Bash man page:</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><div class="line">. filename [arguments]</div><div class="line">source filename [arguments]</div><div class="line"><span class="code">       Read  and  execute  commands  from filename in the current shell</span></div><div class="line"><span class="code">       environment and return the exit status of the last command  exeâ€</span></div><div class="line"><span class="code">       cuted from filename.  If filename does not contain a slash, file</span></div><div class="line"><span class="code">       names in PATH are used to find the  directory  containing  fileâ€</span></div><div class="line"><span class="code">       name.   The  file  searched  for in PATH need not be executable.</span></div><div class="line"><span class="code">       When bash is  not  in  posix  mode,  the  current  directory  is</span></div><div class="line"><span class="code">       searched  if no file is found in PATH.  If the sourcepath option</span></div><div class="line"><span class="code">       to the shopt builtin command is turned  off,  the  PATH  is  not</span></div><div class="line"><span class="code">       searched.   If any arguments are supplied, they become the posiâ€</span></div><div class="line"><span class="code">       tional parameters when  filename  is  executed.   Otherwise  the</span></div><div class="line"><span class="code">       positional  parameters  are unchanged.  The return status is the</span></div><div class="line"><span class="code">       status of the last command exited within the  script  (0  if  no</span></div><div class="line"><span class="code">       commands  are  executed),  and false if filename is not found or</span></div><div class="line"><span class="code">       cannot be read.</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Linux shell æ‰§è¡Œè„šæœ¬çš„æ—¶å€™ä¸€èˆ¬æ˜¯ä¼š fork å‡ºä¸€ä¸ªå­ shellï¼Œè¿™æ ·åœ¨æœ‰çš„æ—¶å€™å°±ä¸æ–¹ä¾¿äº†ï¼Œæ¯”å¦‚è¦unset å½“å‰shell çš„ç¯å¢ƒå˜é‡ç­‰ï¼Œ&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;c
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Rubyçš„ open å‡½æ•°å¯¼è‡´å‘½ä»¤æ‰§è¡Œ</title>
    <link href="http://cyukang.com/2018/02/12/ruby-open-vul.html"/>
    <id>http://cyukang.com/2018/02/12/ruby-open-vul.html</id>
    <published>2018-02-12T12:39:46.000Z</published>
    <updated>2018-02-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><p>é¦–å…ˆçœ‹çœ‹ open å‡½æ•°çš„æ–‡æ¡£è¯´æ˜ï¼Œ <a href="https://apidock.com/ruby/v1_9_3_392/Kernel/open/classï¼š" target="_blank" rel="external">https://apidock.com/ruby/v1_9_3_392/Kernel/open/classï¼š</a> </p>
<blockquote>
<p>If <em>path</em> starts with a pipe character, a subprocess is created, connected to the <a href="https://apidock.com/ruby/Kernel/caller" target="_blank" rel="external">caller</a> by a pair of pipes. The returned <a href="https://apidock.com/ruby/IO" target="_blank" rel="external">IO</a> object may be used to write to the standard input and read from the standard output of this subprocess. If the command following the â€œ|â€ is a single minus sign, Ruby forks, and this subprocess is connected to the parent. In the subprocess, the <a href="https://apidock.com/ruby/Kernel/open" target="_blank" rel="external">open</a> call returns nil. If the command is not â€œ-â€, the subprocess runs the command. If a block is associated with an <a href="https://apidock.com/ruby/Kernel/open" target="_blank" rel="external">open</a>(â€œ|-â€) call, that block will be run twiceâ€”once in the parent and once in the child. The block parameter will be an <a href="https://apidock.com/ruby/IO" target="_blank" rel="external">IO</a> object in the parent and nil in the child. The parentâ€™s <a href="https://apidock.com/ruby/IO" target="_blank" rel="external">IO</a> object will be connected to the childâ€™s stdin  and stdout. The subprocess will be terminated at the end of the block.</p>
</blockquote>
<p>å…¶ä¸­è¯´æ˜äº†å¦‚æœä»¥|å¼€å¤´åˆ™ä¼š fork å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œ<code>|</code> åé¢çš„å†…å®¹åˆ™ä¼šå½“æˆä¸€æ¡å‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚ï¼š </p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><div class="line">cmd = open(<span class="string">"|date"</span>)</div><div class="line">print cmd.gets</div><div class="line">cmd.close</div><div class="line">=&gt; <span class="number">2018</span>å¹´ <span class="number">2</span>æœˆ<span class="number">12</span>æ—¥ æ˜ŸæœŸä¸€ <span class="number">21</span>æ—¶<span class="number">37</span>åˆ†<span class="number">45</span>ç§’ CST</div></pre></td></tr></table></figure>
<h4 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h4><p>æ­£å› ä¸ºè¿™æ ·ï¼Œè¿™ä¸ª open å‡½æ•°çœŸçš„æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæœ€è¿‘çš„è¿™ä¸ª PRï¼š </p>
<p><a href="https://github.com/ruby/ruby/pull/1777" target="_blank" rel="external">https://github.com/ruby/ruby/pull/1777</a></p>
<p>ä¹‹å‰æˆ‘ä»¬çš„é¡¹ç›®é‡Œä¹Ÿå‡ºç°è¿‡ç±»ä¼¼çš„æƒ…å†µï¼Œç›´æ¥ç›¸å½“äºä¸€ä¸ª webshellï¼Œä»»æ„æ‰§è¡Œå‘½ä»¤ã€‚è¿™æ ·çš„ command injection å½“ç„¶ä¹Ÿå¾ˆå¥½æ£€æµ‹ï¼Œbrakeman ä¹‹ç±»çš„å°±å¯ä»¥ã€‚æ‰€ä»¥ Railsé¡¹ç›®è¿˜æ˜¯æ—¶ä¸æ—¶åœ°æ‰«æä¸€ä¸‹æ¯”è¾ƒå¥½ã€‚</p>
<p>Ruby é‡Œé¢æœ‰å‡ ä¸ª Openï¼Œ<a href="https://stackoverflow.com/questions/1727217/file-open-open-and-io-foreach-in-ruby-what-is-the-difference" target="_blank" rel="external">è¿™é‡Œ</a>æœ‰æ¯”è¾ƒæ˜æ™°çš„è§£é‡Šï¼ŒKernel.open è¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ª wrapperï¼Œæ ¹æ®ä¸åŒçš„æƒ…å†µåšå¯¹åº”çš„å¤„ç†ã€‚è¶Ÿå¤šäº†å‘ä¹‹åï¼Œæ‰ä¼šè§‰å¾—è¿™æ ·çš„ç‰¹æ€§å…¶å®æ˜¯å¢åŠ äº†ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œæ¯”å¦‚è¿™ä¸ª<code>|</code>ç‰¹æ€§å¯èƒ½æœ‰çš„äººå°±æ²¡æ³¨æ„åˆ°ï¼Œå³ä½¿æ˜¯çœ‹è¿‡æ–‡æ¡£ä¹Ÿå¯èƒ½çœ‹åˆ°äº†<a href="https://apidock.com/ruby/v1_8_6_287/Kernel/open" target="_blank" rel="external">è€ç‰ˆæœ¬çš„æ–‡æ¡£</a>ï¼Œä»è€Œä¸çŸ¥é“è¿™ä¸ªè¾¹è¾¹è§’è§’ã€‚</p>
<p>å½“ç„¶åŒæ ·çš„ systemè¿™æ ·çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„æƒ…å†µï¼Œæ¯”å¦‚<a href="https://github.com/OWASP/railsgoat/wiki/A1-Command-Injection" target="_blank" rel="external">railsgoat é‡Œçš„è¿™ä¸ª command injection</a>ã€‚åŸåˆ™æ˜¯å¯¹äºä»»ä½•ç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œéƒ½éœ€è¦åšä¸å®‰å…¨çš„å‡è®¾ï¼Œåšå¥½æ£€æŸ¥ã€‚</p>
<p><a href="https://github.com/OWASP/railsgoat" target="_blank" rel="external">https://github.com/OWASP/railsgoat</a>è¿™ä¸ªé¡¹ç›®é‡Œæœ‰å„ç§ Railsæ¼æ´ï¼Œå€¼å¾—çœ‹çœ‹ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;è¯´æ˜&quot;&gt;&lt;a href=&quot;#è¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;è¯´æ˜&quot;&gt;&lt;/a&gt;è¯´æ˜&lt;/h4&gt;&lt;p&gt;é¦–å…ˆçœ‹çœ‹ open å‡½æ•°çš„æ–‡æ¡£è¯´æ˜ï¼Œ &lt;a href=&quot;https://apidock.com/ruby/v1_9_3_392/Kernel
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>BuckleScript and Reason</title>
    <link href="http://cyukang.com/2017/09/17/bucklescript-and-reason.html"/>
    <id>http://cyukang.com/2017/09/17/bucklescript-and-reason.html</id>
    <published>2017-09-17T14:47:27.000Z</published>
    <updated>2017-09-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h4 id="BuckleScript"><a href="#BuckleScript" class="headerlink" title="BuckleScript"></a>BuckleScript</h4><p>è™½ç„¶æˆ‘ä¸æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸è¿‡å› ä¸ºå–œæ¬¢ OCamlï¼Œæ‰€ä»¥å¶å°”å…³æ³¨ <a href="https://github.com/BuckleScript/bucklescript" target="_blank" rel="external">BuckleScript</a> æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä»Šå¤©åˆèŠ±æ—¶é—´çœ‹äº†çœ‹æ–‡æ¡£å’Œä»£ç ã€‚BuckleScript æ˜¯å¼ å®æ³¢ä¸»å¯¼å¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œã€æœ‰å¸Œæœ›æˆä¸ºç¬¬ä¸€ä¸ªå®Œå…¨ç”±å›½äººè®¾è®¡ä¸»å¯¼å®ç°å¹¶è¢«ä¸–ç•Œå„åœ°å¹¿æ³›ä½¿ç”¨çš„ç¼–è¯‘å™¨ã€ï¼Œä¸è¿‡æ˜¯å¦èƒ½å¹¿æ³›è¢«ä½¿ç”¨è¿˜å¾—çœ‹åç»­æ¨å¹¿ã€‚</p>
<p>ç®€å•æ¥è¯´BuckleScript æ˜¯ä¸€ä¸ªä»£ç è½¬æ¢å™¨ï¼ŒæŠŠä½ å†™çš„ OCaml ä»£ç ç”Ÿæˆä¸ºçº¯ JS ä»£ç ã€‚è¿™æ ·åšçš„å¥½å¤„å’Œå¿…è¦æ€§åœ¨äºï¼š</p>
<ol>
<li>JS å¤ªç‰›äº†ï¼Œ<a href="https://www.youtube.com/watch?v=jFU-wc28lF4" target="_blank" rel="external">è¿™ä¸ªè·¨å¹³å°è¯­è¨€æ­£åœ¨åå™¬ç€æ‰€æœ‰è½¯ä»¶é¢†åŸŸ</a></li>
<li>JSå¤ªéš¾ç»´æŠ¤äº†ï¼Œå¤§è§„æ¨¡çš„ JS ä»£ç æ›´æ˜¯å™©æ¢¦ã€‚ä¸ç®¡æ˜¯ä»å¼€å‘è€…è§’åº¦å’Œæ˜¯ä»ä»£ç å®‰å…¨çš„è§’åº¦ï¼ŒJS éœ€è¦ç±»å‹ï¼<a href="https://www.typescriptlang.org/" target="_blank" rel="external">å¾®è½¯çš„ Typescript</a> å’Œ <a href="https://flow.org/en/" target="_blank" rel="external">FB çš„ Flow</a> ï¼Œç”šè‡³æ˜¯<a href="http://elm-lang.org/examples" target="_blank" rel="external">Elm</a>éƒ½æ˜¯ä¸ºäº†ç»™ JS å¸¦æ¥ç±»å‹ã€‚</li>
<li>OCamlç±»å‹ç³»ç»Ÿç¨³å®šå¯é ï¼Œå…³é”®æ˜¯ç¼–è¯‘å™¨é€Ÿåº¦å¿«ï¼Œå¹¶ä¸”å¯ä»¥ç¼–è¯‘åœ¨å¤šä¸ªå¹³å°ä¸Šã€‚</li>
</ol>
<p>å°±æˆ‘ä¸ªäººè€Œè¨€éå¸¸å–œæ¬¢ OCamlï¼Œä¹‹å‰ä¹Ÿæœ‰ä¸€äº›è‡ªå·±çš„å°é¡¹ç›®ç”¨è¿‡ OCamlã€‚BuckleScriptä»æŠ€æœ¯è§’åº¦æ¥è¯´æ˜¯éå¸¸å¥½çš„ï¼Œæˆ‘çœ‹äº†ä¸€äº›ç”Ÿæˆçš„ä»£ç å¯è¯»æ€§æ¯”å¾ˆå¤šä»£ç ç”Ÿæˆå™¨è¦å¥½ã€‚å¹¶ä¸”é™¤äº†ç›´æ¥ç¿»è¯‘ä»£ç ï¼Œè¿™ä¸ªç¼–è¯‘å™¨ä¹Ÿåšäº†å¾ˆå¤šä»£ç ä¼˜åŒ–çš„å·¥ä½œï¼Œç”Ÿæˆ size æ›´å°ï¼Œperformance æ›´å¥½çš„ JS ä»£ç ã€‚é—æ†¾çš„æ˜¯ç›®å‰è¿˜ä¸æ”¯æŒ Core è¿™ä¸ªåº“ï¼Œæˆ‘ä¹‹å‰ç”¨ Core æ¯”è¾ƒå¤šï¼Œà²¥_à²¥ã€‚</p>
<p>å…³äºä»£ç ç”Ÿæˆï¼Œæƒ³èµ·æˆ‘ä»¬åŸæ¥åšè¿‡çš„ <a href="https://github.com/sipin/gorazor" target="_blank" rel="external">Gorazor</a>ï¼Œä»æŠ€æœ¯è§’åº¦æ¥è¯´è¿˜æ˜¯æœ‰äº›æŒ‘æˆ˜çš„ï¼Œä¸è¿‡ä»ä½¿ç”¨è§’åº¦æˆ‘ä¸ªäººæŒä¿ç•™æ€åº¦ã€‚ä»£ç ç”Ÿæˆæ¯•ç«Ÿä¼šå¼•å…¥æ–°çš„è¯­æ³•ï¼Œæˆ‘å‘ç°å¾ˆå¤šå‰ç«¯ç¨‹åºå‘˜å…¶å®å¹¶ä¸æ€ä¹ˆç†Ÿæ‚‰å‡½æ•°å¼ç¼–ç¨‹é‚£å¥—ï¼ŒOCaml çš„è¯­æ³•æ˜¯å¦èƒ½åœ¨å‰ç«¯ç¨‹åºå‘˜ä¸­æ¨å¹¿å¼€æ¥æ˜¯ä¸ªé—®é¢˜ã€‚BuckleScriptçš„æ–‡æ¡£æœ‰å¾…æ”¹è¿›ï¼Œå¯ä»¥ç»™æ›´å¤šå¤§ä¸€ç‚¹çš„å®Œæ•´çš„ä¾‹å­ã€‚</p>
<p>å…³äºBuckleScriptå’Œjs_of_ocaml çš„åŒºåˆ«ï¼Œä»æ–‡æ¡£ä¸Šæ¥çœ‹js_of_ocaml å¯ä»¥æŠŠ bytecode è½¬æ¢ä¸º JS ä»£ç ï¼Œè€ŒBuckleScriptæ˜¯åœ¨ä»ç¼–è¯‘å™¨é‡Œé¢çš„rawlambdaç”Ÿæˆä»£ç ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ¥è¯´ js_of_ocaml å¯¹ OCaml çš„å…¼å®¹æ€§æ›´å¥½ï¼Œè€ŒBuckleScript èƒ½ç”Ÿæˆæ›´å¯è¯»çš„ JS ä»£ç ï¼Œç›®æ ‡åœ¨äºå…¼å®¹npmå¹³å°ã€‚</p>
<h4 id="ReasonML"><a href="#ReasonML" class="headerlink" title="ReasonML"></a>ReasonML</h4><p><a href="https://reasonml.github.io/" target="_blank" rel="external">ReasonML</a>çš„æ¥ç”±æ˜¯ä¹‹å‰æˆ‘è¯´çš„ OCaml ç‹¬ç‰¹çš„è¯­æ³•ï¼Œåœ¨å¾ˆå¤šäººçœ‹æ¥å¹¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œæ‰€ä»¥FB çš„è¿™ç¾¤äººåšäº†ä¸€ä¸ªæ›´ç¬¦åˆå¤§ä¼—å“ä½çš„æ–¹è¨€ã€‚ç„¶åå¯ä»¥é€šè¿‡ BuckleScript å†ç¿»è¯‘ä¸º JS ä»£ç ã€‚å¥½ç»•å•Šï¼ä¸è¿‡æ®è¯´ FB å·²ç»åœ¨ç”Ÿæˆç¯å¢ƒä½¿ç”¨è¿™äº›äº†ã€‚ReasonML çš„å¼€å‘è€…ç§»æ¤äº†ä¸€ä¸ªä¹‹å‰ç”¨js_of_ocaml å†™çš„<a href="https://github.com/reasonml-community/Mareo" target="_blank" rel="external">mario çš„ä¾‹å­</a>ï¼Œçœ‹äº†ä¸€éè§‰å¾—reason çš„è¯­æ³•å…¶å®æ”¹åŠ¨å¹¶ä¸å¤§ï¼Œå¯èƒ½å¯¹ JS çš„ç¨‹åºå‘˜æ¥è¯´æ›´å‹å¥½å§ã€‚reason å’Œ OCaml çš„å…³ç³»ç±»ä¼¼äº Elixir å’Œ Erlang ä¹‹å‰çš„å…³ç³»ï¼Œä¸ºäº†è®¨å¥½ä¸€ç±»ç¨‹åºå‘˜ï¼Œåˆä¸ºäº†åˆ©ç”¨ä¸€ä¸ªå·²ç»éå¸¸æˆç†Ÿå¯é çš„ç°æœ‰å¹³å°ã€‚</p>
<p>åœ¨ HN ä¸Šæœ‰ä¸€ä¸ªæ¯”è¾ƒè€çš„<a href="https://news.ycombinator.com/item?id=12400397" target="_blank" rel="external">è®¨è®ºå¸–</a>ï¼Œæœ‰æ—¶é—´ä¹Ÿå¯ä»¥å†çœ‹çœ‹ã€‚</p>
<p><a href="https://github.com/BuckleScript/bucklescript/wiki/Why-bucklescript-matters-for-Javascript-platform" target="_blank" rel="external">Why bucklescript matters for Javascript platform</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;BuckleScript&quot;&gt;&lt;a href=&quot;#BuckleScript&quot; class=&quot;headerlink&quot; title=&quot;BuckleScript&quot;&gt;&lt;/a&gt;BuckleScript&lt;/h4&gt;&lt;p&gt;è™½ç„¶æˆ‘ä¸æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œä¸è¿‡å› ä¸ºå–œæ¬¢ OCamlï¼Œæ‰€ä»¥å¶å°”å…³æ³¨
    
    </summary>
    
    
      <category term="OCaml" scheme="http://cyukang.com/tags/OCaml/"/>
    
      <category term="Javascript" scheme="http://cyukang.com/tags/Javascript/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šæ·±åº¦å·¥ä½œ-å¦‚ä½•æœ‰æ•ˆä½¿ç”¨æ¯ä¸€ç‚¹è„‘åŠ›ã€‹è¯»å</title>
    <link href="http://cyukang.com/2017/09/14/deep-work.html"/>
    <id>http://cyukang.com/2017/09/14/deep-work.html</id>
    <published>2017-09-14T14:20:14.000Z</published>
    <updated>2017-09-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://book.douban.com/subject/27056409/" target="_blank" rel="external">æ·±åº¦å·¥ä½œ</a>è¿™æœ¬ä¹¦ä¸»è¦è®²è§£äº†ä¸€äº›æ—¶é—´å’Œç²¾åŠ›ç®¡ç†æ–¹é¢çš„ä¸œè¥¿ï¼Œäººåˆ°äº†ä¸€å®šå¹´é¾„å°±ä¼šè§‰å¾—æ—¶é—´ä¸å¤Ÿç”¨ï¼Œæ—¥å­è¿‡å¾—å¤ªå¿«ï¼Œæ¯å¤©è§‰å¾—éƒ½æ²¡å¹²ä»€ä¹ˆå°±è¿‡å»äº†ã€‚å·¥ä½œå‡ å¹´åè¿™ç§æ„Ÿè§‰æ—¶ä¸æ—¶è¢­æ¥ã€‚åè€Œæ˜¯å¦‚æœæŸæ®µæ—¶é—´ä¸€ç›´æœ‰ä¸€ä¸ªé˜¶æ®µæ€§çš„ç›®æ ‡ï¼Œå°±ä¼šè§‰å¾—å¾ˆè¸å®ï¼Œè¿›åº¦å’Œæ•ˆç‡ä¹Ÿå¯ä»¥ã€‚é‚£ç§å®Œå…¨æ²‰æµ¸åœ¨æ€è€ƒä¸­çš„çŠ¶æ€çœŸçš„ä¹Ÿå¹¶ä¸æ˜¯ç´¯ï¼Œç›¸åæ‰€å¾—åˆ°çš„ç»“æœå¾€å¾€æ˜¯çœŸå®çš„æ”¶è·å’Œè¿›æ­¥ã€‚ç”¨è¿™æœ¬ä¹¦é‡Œçš„æœ¯è¯­å¯ä»¥ç§°ä¹‹ä¸ºã€æ·±åº¦å·¥ä½œã€çš„é˜¶æ®µå§ã€‚</p>
<p>è¯´èµ·æ¥ä¹Ÿæœ‰é“ç†ï¼Œå¦‚æœè‡ªè®¤ä¸ºæˆ‘ä»¬æ˜¯çŸ¥è¯†å·¥ä½œè€…ï¼Œé‚£ä¹ˆå¤§å¤šæ•°æ—¶é—´å¤„äºæµ®æ½œçš„å·¥ä½œçŠ¶æ€å°±å¾—ä¸åˆ°ä»€ä¹ˆæ·±åˆ»çš„ç»“æœã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä¹Ÿæœ‰æ—¶å€™æ„Ÿè§‰è‡ªå·±å¹¶ä¸æ˜¯åœ¨åšä»€ä¹ˆé«˜æ·±çš„å·¥ä½œï¼Œé‚£ä¹ˆè¿™æ ·é•¿ä¹…ä¸‹å»ä¼šæ€ä¹ˆæ ·å‘¢ï¼Œéšä¹‹è€Œæ¥çš„æ˜¯ä¸å¯é¿å…çš„å‹åŠ›ã€‚</p>
<p>è¿™é‡Œè®²çš„å››ä¸ªå‡†åˆ™ï¼Œä»»ä½•ä¸€ä¸ªéƒ½å€¼å¾—å¥½å¥½ä¿®ç‚¼ï¼Œå¯¹äºå¤§å¤šæ•°äººè€Œè¨€ï¼Œå¤§è„‘éƒ½å·²ç»è¢«äº’è”ç½‘å’Œæ‰‹æœºè®­ç»ƒå¾—æ„šé’å’Œä¸å¯ä¸“æ³¨äº†ï¼š</p>
<blockquote>
<p>å·¥ä½œè¦æ·±å…¥<br>æ‹¥æŠ±æ— èŠ<br>è¿œç¦»ç¤¾äº¤åª’ä½“<br>æ‘’å¼ƒæµ®æµ…</p>
</blockquote>
<p>æ·±å…¥å·¥ä½œçš„ä»·å€¼åœ¨å½“ä»Šç¤¾ä¼šæ ¼å¤–çªå‡ºï¼Œå› ä¸ºæœºå™¨çš„è¿…çŒ›å‘å±•ï¼Œç‰¹æ®Šçš„æŠ€èƒ½æ‰€å±•ç°çš„ä»·å€¼è¶Šå‘æ˜æ˜¾ã€‚ã€è¿ç»­å¬ä¸€ç³»åˆ—ä¸­ç­‰æ°´å¹³çš„æ­Œæ‰‹å”±æ­Œå¹¶ä¸èƒ½ç´¯åŠ æˆä¸€åœºæ— ä¸ä¼¦æ¯”çš„æ¼”å‡ºâ€” æ¢è¨€ä¹‹ï¼Œæ‰èƒ½å¹¶éä¸€ç§å•†å“ï¼Œä½ ä¸å¯ä»¥é€šè¿‡å¤§æ‰¹è´­ä¹°ï¼Œç„¶åç´¯ç§¯èµ·æ¥è¾¾åˆ°ä¸€å®šæ°´å‡†ï¼Œåªæœ‰æˆä¸ºæœ€ä¼˜ç§€çš„æ‰ä¼šå¾—åˆ°é¢å¤–å¥–åŠ±ã€ã€‚æˆ‘ä»¬æ‰€é¢ä¸´çš„æ—¶ä»£éœ€è¦æŒæ¡ä¸€äº›æ›´ä¸ºå¤æ‚çš„å·¥ä½œå’ŒæŠ€èƒ½ï¼Œè€Œè¿™äº›æŠ€èƒ½å¹¶ä¸æ˜¯éšä¾¿çœ‹çœ‹å°±èƒ½è½»æ˜“å¾—åˆ°çš„ã€‚æ·±å…¥çš„ä¸œè¥¿åªæœ‰é™ä¸‹å¿ƒæ¥ï¼ŒæŒç»­èŠ±å¤§é‡æ—¶é—´å’Œç²¾åŠ›æ‰èƒ½é€æ¸æŒæ¡ã€‚</p>
<p>æƒ³è¦è¿›å…¥æ·±åº¦å·¥ä½œï¼Œä¼šæœ‰ä¸¤ä¸ªæ–¹é¢éœ€è¦æ³¨æ„:</p>
<ol>
<li>æ—¶é—´åˆ†é…ï¼Œå¦‚ä½•é¿å…è¢«é¢‘ç¹æ‰“æ–­ï¼Œå¦‚ä½•å°½é‡å»¶é•¿ä¸€å¤§æ®µå¯ä»¥æŒç»­çš„æ—¶é—´</li>
<li>å­¦ä¹ å’Œé”»ç‚¼æŒç»­ä¸“æ³¨çš„èƒ½åŠ›</li>
</ol>
<p>å…³äºæ—¶é—´åˆ†é…ï¼Œæˆ‘ä¹‹å‰å°è¯•è¿‡ç•ªèŒ„å·¥ä½œæ³•ï¼Œä½†æ˜¯æ„Ÿè§‰å¹¶ä¸å¥½ã€‚å› ä¸ºä»ªå¼æ„Ÿå¤ªå¼ºå’Œå¤ªé¢‘ç¹ï¼Œåœ¨æˆ‘æ­£åœ¨è¿›å…¥å·¥ä½œçŠ¶æ€çš„æ—¶å€™å¯èƒ½å°±åˆ°äº†èŠ‚ç‚¹ã€‚å¯¹äºå¤§å¤šæ•°ç¨‹åºå‘˜æ¥è¯´æ™šä¸Šå¯èƒ½æ˜¯æœ€èƒ½å®‰é™çš„å†™ç¨‹åºå’Œæ€è€ƒçš„æ—¶é—´ï¼Œä¸è¿‡éšç€æ›´å¤šçš„å®¶åº­è´£ä»»ï¼Œæ™šä¸Šçš„æ—¶é—´ä¹ŸçŸ­äº†ã€‚æ‰€ä»¥ç°åœ¨æˆ‘æ‰“ç®—æ—©ä¸Šå°½æ—©èµ·æ¥ï¼Œè¿™æ ·è¿˜æœ‰ä¸€ä¸¤ä¸ªå°æ—¶åŠ ä»¥åˆ©ç”¨ã€‚</p>
<p>å…³äºä¸“æ³¨èƒ½åŠ›è¿™å—ï¼š</p>
<blockquote>
<p>ä¸æ–­åœ°åˆ‡æ¢æ³¨æ„åŠ›ä¼šå¯¹å¤§è„‘äº§ç”Ÿé•¿ä¹…çš„è´Ÿé¢å½±å“</p>
</blockquote>
<p>è¿™ä¸ªç»“è®ºåº”è¯¥å¤§å®¶éƒ½æœ‰ä½“ä¼šï¼ŒæŒç»­ä¸“æ³¨çš„èƒ½åŠ›å¾€å¾€å†³å®šäººçš„èƒ½åŠ›ï¼Œæœ‰çš„äººå¯ä»¥ä¸€ç›´è„‘è¢‹é‡Œæƒ³ç€é—®é¢˜ï¼Œå³ä½¿æ˜¯åœ¨èµ°è·¯æˆ–è€…åƒé¥­çš„æ—¶å€™ã€‚ä¹‹å‰åœ¨å­¦æ ¡æˆ‘ä¹Ÿæœ‰è¿‡ä¸€æ®µæ—¶é—´ï¼Œè„‘è¢‹é‡Œä¸€ç›´åœ¨æƒ³ç€è¦æ‰¾çš„ç­”æ¡ˆï¼Œé‚£ç§ä½“éªŒå·²ç»å¥½ä¹…æ²¡æœ‰äº†ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿™æœ¬ä¹¦è¿˜ä¸é”™ï¼Œæ¨èæœ‰æ—¶é—´çš„è¯çœ‹çœ‹ã€‚</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://book.douban.com/subject/27056409/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;æ·±åº¦å·¥ä½œ&lt;/a&gt;è¿™æœ¬ä¹¦ä¸»è¦è®²è§£äº†ä¸€äº›æ—¶é—´å’Œç²¾åŠ›ç®¡ç†æ–¹é¢çš„ä¸œè¥¿ï¼Œäººåˆ°äº†ä¸€å®šå¹´é¾„å°±ä¼šè§‰å¾—æ—¶é—´ä¸å¤Ÿç”¨ï¼Œæ—¥å­è¿‡å¾—å¤ªå¿«
    
    </summary>
    
    
      <category term="Books" scheme="http://cyukang.com/tags/Books/"/>
    
  </entry>
  
  <entry>
    <title>Kongçš„0.11.0ç‰ˆæœ¬</title>
    <link href="http://cyukang.com/2017/09/12/kong-new-release.html"/>
    <id>http://cyukang.com/2017/09/12/kong-new-release.html</id>
    <published>2017-09-12T06:43:00.000Z</published>
    <updated>2017-09-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>Kongå‘å¸ƒäº†æ–°çš„ç‰ˆæœ¬<a href="https://github.com/Mashape/kong/releases/tag/0.11.0" target="_blank" rel="external">0.11.0</a>ï¼Œä»è¿™é‡Œå¼€å§‹åŒºåˆ†äº†ç¤¾åŒºç‰ˆæœ¬å’Œå•†ä¸šç‰ˆã€‚è¿™æ¬¡æ”¹åŠ¨æ¯”è¾ƒå¤§çš„æ˜¯ä¸¢å¼ƒäº†serfï¼Œè¿™æ ·æ•´ä¸ªKongèŠ‚ç‚¹ä¹‹é—´çš„ç¼“å­˜åŒæ­¥æ–¹å¼å˜åŒ–äº†ã€‚å¼€å‘è€…ç»™å‡ºçš„ç†ç”±å¦‚ä¸‹ï¼š </p>
<ol>
<li>ä¾èµ–serfï¼Œserfå¹¶ä¸å±äºNginx/OpenResty</li>
<li>è¿™ç§ä¾èµ–ç›¸äº’é—´é€šä¿¡æ¥åŒæ­¥çš„æœºåˆ¶å¯¹äºdeploymentå’Œå®¹å™¨åŒ–éƒ½æœ‰äº›ä¸ä¾¿</li>
<li>åœ¨è¿è¡Œçš„KongèŠ‚ç‚¹è§¦å‘serféœ€è¦ä¸€äº›ç§Ÿå¡çš„I/O</li>
</ol>
<p>æ–°çš„å®ç°çš„æ€è·¯æ˜¯ä»¥æ•°æ®åº“ä½œä¸ºä¸­å¿ƒï¼Œå¢åŠ ä¸€ä¸ªcluster eventsçš„è¡¨ã€‚ä»»ä½•Kong nodeéƒ½å¯ä»¥å‘æ•°æ®åº“å‘é€å˜æ›´æ¶ˆæ¯ï¼Œå…¶ä»–èŠ‚ç‚¹pollingæ•°æ®åº“æ”¹åŠ¨ï¼Œç„¶åæ¥æ›´æ–°ç¼“å­˜å†…å®¹ã€‚è¿™ä¸ªæ”¹åŠ¨éå¸¸å¤§ï¼Œä¸è¿‡æœ€ç»ˆKongç»ˆäºå®ç°äº†èŠ‚ç‚¹æ— çŠ¶æ€ï¼Œä¹‹å‰é‚£ä¸ªæ•°æ®åº“é‡Œçš„nodeså¯ä»¥ä¸¢å¼ƒæ‰äº†ï¼Œä»»ä½•æ—¶å€™èŠ‚ç‚¹é‡å¯åªè¦è¿ä¸Šæ•°æ®åº“å³å¯å·¥ä½œã€‚æˆ‘ä»¬éœ€è¦æ‹…å¿ƒçš„æ˜¯è¿™ä¹ˆå¤šèŠ‚ç‚¹å»pollingæ•°æ®åº“(å½“ç„¶è¿™äº›åŠ¨ä½œéƒ½æ˜¯åœ¨åå°)ï¼Œæ˜¯å¦æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„å·¥ä½œã€‚</p>
<p>Kongå¢åŠ äº†æ–°çš„é…ç½®é€‰é¡¹db_update_frequencyï¼Œé»˜è®¤ä¸º5sï¼Œè¡¨ç¤ºå¤šé•¿æ—¶é—´pollingä¸€æ¬¡ï¼Œè¿™éœ€è¦ç”¨æˆ·è‡ªå·±æƒè¡¡æ•ˆç‡å’ŒåŠæ—¶æ€§äº†ã€‚å¯¹äºæˆ‘ä»¬çš„ä¸šåŠ¡æ¥è¯´åŠæ—¶æ€§è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬æ–°å“å‘å¸ƒæ—¶é—´ç²¾ç¡®åˆ°ç§’ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å°½é‡è°ƒä½è¿™ä¸ªå‚æ•°ã€‚</p>
<p>æ‰€æœ‰çš„æ”¹åŠ¨åœ¨<a href="https://github.com/Mashape/kong/pull/2561/filesï¼Œ" target="_blank" rel="external">https://github.com/Mashape/kong/pull/2561/filesï¼Œ</a></p>
<p>æˆ‘å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ä»£ç ï¼Œä¸€äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>clusterç›¸å…³çš„APIå’Œcmdéƒ½è¢«ç§»æ‰äº†ï¼Œå¯åŠ¨éƒ¨åˆ†å’Œserfä¿¡å·å¤„ç†éƒ¨åˆ†éƒ½åˆ æ‰äº†ä¸å°‘ä»£ç ã€‚</li>
<li>pollingéœ€è¦é¿å…ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ä¸Šä¸€æ¬¡pollingè¿˜æœªæ‰§è¡Œå®Œæˆï¼Œä¸‹ä¸€æ¬¡pollingå°±ä¸åº”è¯¥å¯åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦é”æ¥å¤„ç†ã€‚<a href="https://github.com/Mashape/kong/pull/2561/files#diff-44982f7ff5cb89eaf66ed31217aa0d12" target="_blank" rel="external">kong/cluster_events.lua</a>å®ç°äº†pollingçš„ä¸»è¦è¿‡ç¨‹ã€‚</li>
<li><a href="https://github.com/Mashape/kong/pull/2561/files#diff-904358fb4394ddf0541b4b3ede669a82" target="_blank" rel="external">kong/cluster_events/strategies/postgres.lua</a>ç›®å‰pollingè¿˜ä¸æ”¯æŒåˆ†é¡µï¼Œcluster_eventsæ˜¯ä¸€ä¸ªæ–°å»ºçš„è¡¨ç”¨æ¥å­˜å‚¨ç¼“å­˜æ›´æ–°äº‹ä»¶ï¼ŒKongèŠ‚ç‚¹å°±æ˜¯æ¥æŸ¥è¯¢è¿™äº›äº‹ä»¶ã€‚</li>
<li>ç¼“å­˜éƒ¨åˆ†æ¢æˆäº†<a href="https://github.com/thibaultcha/lua-resty-mlcache" target="_blank" rel="external">lua-resty-mlcache</a>ï¼ŒåŸæ¥è¿˜æ˜¯å’Œä¹‹å‰åˆ†æçš„ç±»ä¼¼ L1çº§åˆ«ç¼“å­˜ä¸ºä¸€ä¸ªLURcacheï¼Œåœ¨LuaVMé‡Œå¯è§ï¼Œ L2çº§åˆ«çš„ç¼“å­˜ä¸ºlua_shared_dictï¼ŒåŒä¸€ä¸ªNginxä¸‹çš„æ‰€æœ‰workerå¯è§ï¼Œ L3å°±æ˜¯ç¼“å­˜æœªå‘½ä¸­çš„æƒ…å†µï¼Œéœ€è¦è°ƒç”¨å…¶ä»–hookupçš„å‡½æ•°å»è·å–æ•°æ®ç„¶åç¼“å­˜åœ¨L2ã€‚åªæ˜¯è¿™é‡Œä¸ªipcå¹¶ä¸æ˜¯ç”¨çš„lua-resty-mlcacheé‡Œçš„ï¼Œè€Œæ˜¯ä½¿ç”¨çš„resty.worker.eventsã€‚</li>
<li>äº‹ä»¶å¤„ç†éƒ¨åˆ†åˆ†ä¸¤éƒ¨åˆ†ï¼Œworkerä¹‹é—´çš„äº‹ä»¶å’Œnodeä¹‹é—´çš„å¤„ç†ï¼Œåˆ†åˆ«ç”±worker_eventså’Œcluster_event.luaæ¥å¤„ç†ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Kongå‘å¸ƒäº†æ–°çš„ç‰ˆæœ¬&lt;a href=&quot;https://github.com/Mashape/kong/releases/tag/0.11.0&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;0.11.0&lt;/a&gt;ï¼Œä»è¿™é‡Œå¼€å§‹åŒºåˆ†äº†ç¤¾åŒºç‰ˆæœ¬å’Œå•†ä¸šç‰ˆã€‚è¿™æ¬¡æ”¹åŠ¨æ¯”
    
    </summary>
    
    
      <category term="Lua" scheme="http://cyukang.com/tags/Lua/"/>
    
      <category term="Kong" scheme="http://cyukang.com/tags/Kong/"/>
    
  </entry>
  
  <entry>
    <title>Luaæ—¶é—´å¤„ç†</title>
    <link href="http://cyukang.com/2017/09/12/lua-time-related.html"/>
    <id>http://cyukang.com/2017/09/12/lua-time-related.html</id>
    <published>2017-09-12T01:51:00.000Z</published>
    <updated>2017-09-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘éœ€è¦ç”¨Luaå¤„ç†ä¸€ä¸ªä¸æ—¶é—´ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®ä¸€ä¸ªæ—¥æœŸ(åŒ—äº¬æ—¶é—´)ï¼Œç„¶ååœ¨Openrestyé‡Œé¢åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨è¿™ä¸ªæ—¥æœŸä¹‹å‰æˆ–è€…ä¹‹åæ¥åšå¯¹åº”çš„é€»è¾‘ã€‚</p>
<p>Luaçš„æ—¶é—´å¤„ç†è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œä¸»è¦æ˜¯è‡ªå¸¦çš„ç›¸å…³åº“å‡½æ•°æ¯”è¾ƒå°‘ã€‚</p>
<blockquote>
<p>os.time()                &lt;== è¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥å†æ—¶é—´ï¼Œ 1505181586<br>os.date()                &lt;== è¿”å›æœ¬åœ°åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²ï¼ŒTue Sep 12 09:59:56 2017<br>os.clock()               &lt;== è¿”å›æ‰§è¡Œè¯¥ç¨‹åºCPUèŠ±å»çš„æ—¶é’Ÿç§’æ•°ï¼Œè¿™é‡Œæ˜¯1156.726</p>
</blockquote>
<p>æˆ‘é¦–å…ˆéœ€è¦ä¸€ä¸ªæ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¶é—´æˆ³çš„å‡½æ•°ï¼Œæ‰¾æ¥æ‰¾å»æœ‰äº†è¿™ä¹ˆä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç„¶åç»„æˆè¡¨ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">convert_time</span><span class="params">(time_str)</span></span></div><div class="line">  <span class="comment">-- Assuming a date pattern like: yyyy-mm-dd hh:mm:ss</span></div><div class="line">  <span class="comment">-- Assuming timezone is Beijing</span></div><div class="line">  <span class="keyword">local</span> pattern = <span class="string">"(%d+)-(%d+)-(%d+) (%d+):(%d+):(%d+)"</span></div><div class="line">  <span class="keyword">local</span> year, month, day, hour, minute, seconds = time_str:<span class="built_in">match</span>(pattern)</div><div class="line">  <span class="keyword">if</span> <span class="keyword">not</span> (year <span class="keyword">and</span> month <span class="keyword">and</span> day <span class="keyword">and</span> hour <span class="keyword">and</span> minute <span class="keyword">and</span> seconds) <span class="keyword">then</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  <span class="keyword">local</span> converted_timestamp =</div><div class="line">    <span class="built_in">os</span>.<span class="built_in">time</span>(&#123;tz = <span class="string">"CST"</span>, year = year, month = month,</div><div class="line">             day = day, hour = hour, <span class="built_in">min</span> = minute, sec = seconds&#125;)</div><div class="line">      </div><div class="line">    <span class="keyword">return</span> converted_timestamp </div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨os.time()è·å–å½“å‰æ—¶é—´æˆ³æ¥å¯¹æ¯”ã€‚ä½†æ˜¯å¿…é¡»æ³¨æ„æ—¶åŒºé—®é¢˜ï¼ŒLuaé‡Œé¢è¦è·å–å½“å‰æ—¶åŒºå’ŒUTCé‡Œé¢çš„offsetå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒç¬¨æ‹™çš„åŠæ³•ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_timezone_offset_with_utc</span><span class="params">()</span></span></div><div class="line">  <span class="keyword">local</span> now = <span class="built_in">os</span>.<span class="built_in">time</span>()</div><div class="line">  <span class="keyword">return</span> <span class="built_in">os</span>.<span class="built_in">difftime</span>(now, <span class="built_in">os</span>.<span class="built_in">time</span>(<span class="built_in">os</span>.<span class="built_in">date</span>(<span class="string">"!*t"</span>, now)))</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>ä½¿ç”¨è¿™ä¸ªå‡½æ•°è·å–æ—¶åŒºçš„offsetä¹‹åï¼Œå¯¹convert_timeè¿”å›çš„ç»“æœåšä¸€ä¸‹åç§»å³å¯å’Œos.time()åšå¯¹æ¯”ã€‚æœ‰ä¸ªé—®é¢˜æ˜¯ä¸Šé¢çš„å‡½æ•°å±…ç„¶è°ƒç”¨äº†ä¸‰æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå¼€é”€æ˜¯æ¯”è¾ƒå¤§çš„ã€‚</p>
<blockquote>
<p>åœ¨ OpenResty çš„ä¸–ç•Œé‡Œï¼Œä¸æ¨èä½¿ç”¨è¿™é‡Œçš„æ ‡å‡†æ—¶é—´å‡½æ•°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°é€šå¸¸ä¼šå¼•å‘ä¸æ­¢ä¸€ä¸ªæ˜‚è´µçš„ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒæ—¶æ— æ³•ä¸º LuaJIT JIT ç¼–è¯‘ï¼Œå¯¹æ€§èƒ½é€ æˆè¾ƒå¤§å½±å“ã€‚æ¨èä½¿ç”¨ ngx_lua æ¨¡å—æä¾›çš„å¸¦ç¼“å­˜çš„æ—¶é—´æ¥å£ï¼Œå¦‚ <code>ngx.today</code>, <code>ngx.time</code>, <code>ngx.utctime</code>, <code>ngx.localtime</code>, <code>ngx.now</code>, <code>ngx.http_time</code>ï¼Œä»¥åŠ <code>ngx.cookie_time</code> ç­‰ã€‚</p>
</blockquote>
<p><a href="https://github.com/stevedonovan/Penlight/blob/master/lua/pl/Date.lua" target="_blank" rel="external">Penlight</a>åº“ä¹Ÿæœ‰å¾ˆå¤šæ—¥æœŸç›¸å…³çš„å‡½æ•°å°è£…ï¼Œä¸è¿‡å¤§å¤šä¹Ÿéƒ½ä½¿ç”¨äº†osç›¸å…³å‡½æ•°ã€‚ä¸ºäº†é¿å…å¤šæ¬¡è°ƒç”¨get_timezone_offset_with_utcæˆ‘ä½¿ç”¨äº†Kongé‡Œé¢è‡ªå¸¦çš„cacheç›¸å…³å‡½æ•°åšä¸€ä¸‹ç¼“å­˜ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><div class="line"><span class="comment">-- ç¼“å­˜ä¸Šé¢çš„æ—¶åŒºå·®ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨</span></div><div class="line"><span class="keyword">local</span> offset_with_cst, err =</div><div class="line">  cache.get_or_set(<span class="string">"timezone_offset"</span>, <span class="literal">nil</span>, get_timezone_offset_with_utc, <span class="literal">nil</span>)</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æˆ‘éœ€è¦ç”¨Luaå¤„ç†ä¸€ä¸ªä¸æ—¶é—´ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶é‡Œé¢é…ç½®ä¸€ä¸ªæ—¥æœŸ(åŒ—äº¬æ—¶é—´)ï¼Œç„¶ååœ¨Openrestyé‡Œé¢åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦åœ¨è¿™ä¸ªæ—¥æœŸä¹‹å‰æˆ–è€…ä¹‹åæ¥åšå¯¹åº”çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;Luaçš„æ—¶é—´å¤„ç†è¿˜æœ‰ç‚¹éº»çƒ¦ï¼Œä¸»è¦æ˜¯è‡ªå¸¦çš„ç›¸å…³åº“å‡½æ•°æ¯”è¾ƒå°‘ã€‚&lt;/p&gt;
&lt;blockquot
    
    </summary>
    
    
      <category term="Lua" scheme="http://cyukang.com/tags/Lua/"/>
    
  </entry>
  
</feed>
