<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and writing">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  <meta property="og:site_name" content="ç¨‹åºå‘˜çš„å–µ">
  <meta property="og:title" content="ã€ŠAdvanced linux progammingã€‹ç¬”è®° | ç¨‹åºå‘˜çš„å–µ" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="" />
  <meta property="og:description" content="" />
  <meta property="og:image" content=" http://catcoding.me/css/images/logo.png " />
  <link rel="alternate" type="application/rss+xml" title="ç¨‹åºå‘˜çš„å–µ; Feed" href="https://catcoding.me/atom.xml" />

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/prism.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">

  
<script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/geopattern.min.js"></script>
<script src="/js/nprogress.min.js"></script>

  
  
  <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
    
    ã€ŠAdvanced linux progammingã€‹ç¬”è®° |
    ç¨‹åºå‘˜çš„å–µ
    
  </title>

  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
    <img src="/css/images/logo.png" width='400px' height='400px' />
  </div>

  
  


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'UA-77282254-1');
  </script>

<meta name="generator" content="Hexo 5.4.2"></head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ç¨‹åºå‘˜çš„å–µ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      

        <li class="list-item" style="margin: 0">
       <a class="icon-small" href="/search">
        <span class="fa-stack fa-lg">
          <i class="fa fa-search fa-stack-1x fa-inverse" style="color:#8ccb8c"></i>
        </span>
       </a>
      </li>

       <li class="list-item" style="margin-left: 3px">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>
    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>ã€ŠAdvanced linux progammingã€‹ç¬”è®°</h2>
  <p class="post-date">2011-06-14</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>


<main class="app-body flex-box">

  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h2>Writing and using Libraries</h2>

<p><p class="first">é“¾æ¥åˆ†ä¸ºåŠ¨æ€é“¾æ¥å’Œé™æ€é“¾æ¥ã€‚</p>
<h3><a name="sec2" id="sec2"></a><br>Archives</h3>

<p><p class="first">archive(é™æ€é“¾æ¥) ä¸ºç›®æ ‡æ–‡ä»¶çš„é›†åˆï¼Œlinker ä» archive æ–‡ä»¶ä¸­æ‰¾åˆ° obj æ–‡ä»¶è¿›è¡Œé“¾æ¥ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">% ar cr libtest.a test1.o test2.o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆ›å»ºåº“æ–‡ä»¶ libtest.a(ç±»ä¼¼ windows ä¸‹ test.lib)ï¼Œå½“ linker å¤„ç† archive æ–‡ä»¶çš„æ—¶å€™ï¼Œå°†åœ¨åº“æ–‡ä»¶ä¸­æŸ¥æ‰¾å½“å‰å·²ç»å¤„ç†ä½†æ˜¯è¿˜æ²¡å®šä¹‰çš„ symbolsã€‚æ‰€ä»¥åº“æ–‡ä»¶åº”è¯¥å‡ºç°åœ¨å‘½ä»¤çš„æœ€åã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">% gcc -o app app.o -L. -ltest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3><a name="sec3" id="sec3"></a><br>Shared Library</h3>

<p><p class="first">Shared lib å’Œ archive çš„ä¸¤ä¸ªåŒºåˆ«ï¼š 1ï¼Œå½“è¿›è¡Œçš„æ˜¯åŠ¨æ€é“¾æ¥ï¼Œæœ€åå¾—åˆ°çš„å¯æ‰§è¡Œç¨‹åºä¸­ä¸åŒ…å«å®é™…åº“ä¸­çš„æ‰§è¡Œä»£ç ï¼Œåªæ˜¯ä¸€ä¸ªå¯¹åº“çš„å¼•ç”¨ã€‚æ‰€ä»¥åŠ¨æ€é“¾æ¥æœ€åå¾—åˆ°çš„å¯æ‰§è¡Œç¨‹åºè¦å°ä¸€äº›ã€‚ 2 å¤šä¸ªç¨‹åºå¯ä»¥å…±äº«åŠ¨æ€é“¾æ¥åº“ï¼ŒåŠ¨æ€é“¾æ¥åº“ä¸åªæ˜¯ obj æ–‡ä»¶çš„é›†åˆï¼Œå…¶ä¸­æ˜¯å•ä¸€çš„ä¸€ä¸ª obj æ–‡ä»¶ï¼ŒåŒ…å«äº†åº“ä¸­æ‰€æœ‰çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸€ä¸ªç¨‹åºåŠ¨æ€åŠ è½½ shared lib çš„æ—¶å€™æ˜¯æŠŠåº“ä¸­æ‰€æœ‰çš„ä¸œè¥¿éƒ½åŠ è½½äº†ï¼Œè€Œä¸æ˜¯æ‰€å¼•ç”¨çš„é‚£éƒ¨åˆ†ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">% gcc -c -fPIC test1.c
% gcc -shared - fPIC libtest.so test1.o test2.o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>-fPIC é€‰é¡¹æŒ‡ç¼–è¯‘ä¸ºä½ç½®ç‹¬ç«‹çš„æ‰§è¡Œä»£ç ï¼Œè¿™æ ·å¯ä»¥åŠ¨æ€åŠ è½½ï¼Œäº§ç”Ÿ libtest.so æ–‡ä»¶ã€‚</p>
<p>é»˜è®¤çš„åº“æ–‡ä»¶å¯»æ‰¾è·¯å¾„å˜é‡ï¼šLD_LIBRARY_PATH<br>åº“æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼šå¦‚æœæ˜¯åŠ¨æ€é“¾æ¥ï¼Œé“¾æ¥åº“ä¼šè‡ªåŠ¨å¯»æ‰¾åˆ°è‡ªå·±æ‰€ä¾èµ–çš„å…¶ä»–åº“æ–‡ä»¶ï¼Œå¦‚æœæ˜¯é™æ€é“¾æ¥ï¼Œå¿…é¡»ä¸º linker æä¾›æ‰€æœ‰ä¾èµ–çš„åº“æ–‡ä»¶åç§°ã€‚</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">% gcc -static -o tifftest tifftest.c -ltiff -ljpeg -lz -lm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ tiff ä¾èµ– jpeg åº“ï¼Œå› ä¸ºæ˜¯-static é“¾æ¥ï¼Œå¿…é¡»æŒ‡æ˜æ‰€æœ‰ä¾èµ–çš„åº“æ–‡ä»¶ã€‚</p>
<h3><a name="sec4" id="sec4"></a><br>Pros and Cons</h3>

<p><p class="first">åŠ¨æ€é“¾æ¥çš„ä¼˜åŠ¿ï¼šå¯ä»¥å‡å°‘å¯æ‰§è¡Œæ–‡ä»¶çš„ sizeï¼Œå¦‚æœåº“æ–‡ä»¶è¿›è¡Œå‡çº§ï¼ŒåŸç¨‹åºå¯ä»¥ä¸ç”¨é‡æ–°é“¾æ¥ã€‚å¦‚æœæ˜¯é™æ€é“¾æ¥ï¼Œåº“æ–‡ä»¶æ”¹å˜äº†ç¨‹åºè¦é‡æ–°è¿›è¡Œ linkã€‚<br>ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µå¿…é¡»ä½¿ç”¨ static linkã€‚</p>
<h3><a name="sec5" id="sec5"></a><br>åŠ¨æ€åŠ è½½å’Œå¸è½½åº“</h3>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span><span class="token operator">*</span> handle <span class="token operator">=</span> <span class="token function">dlopen</span> <span class="token punctuation">(</span>â€œlibtest<span class="token punctuation">.</span>soâ€<span class="token punctuation">,</span> RTLD_LAZY<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>test<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">dlsym</span> <span class="token punctuation">(</span>handle<span class="token punctuation">,</span> â€œmy_functionâ€<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span>test<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">dlclose</span> <span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­æ‰“å¼€ libtest.so åŠ¨æ€é“¾æ¥åº“ï¼Œæ‰¾åˆ° my_function å®šä¹‰ï¼Œæ‰§è¡Œï¼Œç„¶åå¸è½½åº“æ–‡ä»¶ã€‚</p>
<h2><a name="sec6" id="sec6"></a><br>è¿›ç¨‹</h2>

<h3><a name="sec7" id="sec7"></a><br>åˆ›å»ºè¿›ç¨‹</h3>

<h4>using system</h4>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token keyword">int</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> return_value<span class="token punctuation">;</span>
  return_value <span class="token operator">=</span> <span class="token function">system</span> <span class="token punctuation">(</span><span class="token string">"ls -l /"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> return_value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>system å°†æ‰§è¡Œ/bin/shï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸ºä¸åŒç³»ç»Ÿä¸­/bin/sh æ‰€é“¾æ¥çš„ shell ä¸åŒï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ‰§è¡Œå·®å¼‚ï¼ŒåŒæ—¶è¿™ç§æ–¹å¼å­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p>
<h4>using fork and exec</h4>

<p><p class="first">fork åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œfork çš„è¿”å›å€¼ç”¨æ¥åŒºåˆ«çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ã€‚å­è¿›ç¨‹å°†å’Œæ‹·è´çˆ¶è¿›ç¨‹ä¸€äº›ä¿¡æ¯ï¼Œæ›´è¯¦ç»†çš„ä¸œè¥¿åœ¨è¿™æœ¬ä¹¦å†…æ²¡è¯´æ˜ã€‚</p>
<p>exec å‡½æ•°å®¶æ—ï¼Œfork åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”¨ exec åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h4>process scheduling</h4>

<p><p class="first">nice å‘½ä»¤å¯ä»¥è°ƒèŠ‚ process çš„ä¼˜å…ˆæƒå€¼ã€‚<br>niceness value è¶Šå¤§ï¼Œè¿›ç¨‹çš„ä¼˜å…ˆæƒè¶Šä½ï¼Œè¶Šå°è¿›ç¨‹çš„ä¼˜å…ˆæƒè¶Šé«˜ã€‚ä¸€èˆ¬è¿›ç¨‹çš„ niceness value ä¸º 0ã€‚åªæœ‰ root çš„è¿›ç¨‹å¯ä»¥å‡å°‘ä¸€ä¸ªè¿›ç¨‹çš„ niceness valueã€‚</p>
<h3><a name="sec8" id="sec8"></a><br>signal</h3>

<p><p class="first">signal is asynchronous:è¿›ç¨‹æ”¶åˆ°ä¿¡å·çš„æ—¶å€™ä¼šç«‹å³å¤„ç†ä¿¡å·ï¼Œå¤„ç†ä¿¡å·çš„ä¸€èˆ¬æ–¹å¼åˆ†ä¸ºå‡ ç±»ï¼šå¿½ç•¥ï¼Œæ‰§è¡Œé»˜è®¤å¤„ç†ï¼Œæ‰§è¡Œç‰¹å®šçš„å¤„ç†ç¨‹åºã€‚<br>å› ä¸ºä¿¡å·å¤„ç†æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­å°½é‡ä¸è¦æ‰§è¡Œ IOï¼Œæˆ–è€…è°ƒç”¨åº“å‡½æ•°ã€‚ä¿¡å·å¤„ç†å‡½æ•°åº”è¯¥ä½œæœ€å°‘é‡çš„å·¥ä½œï¼Œå°½å¿«è¿”å›åˆ°ä¸»æµç¨‹ä¸­ï¼Œæˆ–è€…å¹²è„†ç»“æŸæ‰ç¨‹åºã€‚ä¸€èˆ¬åªæ˜¯è®¾ç½®å˜é‡è¡¨æ˜æŸä¸ªä¿¡å·å‘ç”Ÿäº†ï¼Œä¸»ç¨‹åºå®šæ—¶æ£€æŸ¥å˜é‡å†å¤„ç†ã€‚SIGTERM å’Œ SIGKILL åŒºåˆ«ï¼Œå‰ä¸€ä¸ªå¯èƒ½è¢«å¿½ç•¥ï¼Œåä¸€ä¸ªä¸èƒ½è¢«å¿½ç•¥ã€‚<br>æ”¹å˜ sig_atomic_t çš„å€¼çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p>
<h3><a name="sec9" id="sec9"></a><br>process exit</h3>

<p><p class="first">exit(int return_value) å‡½æ•°é€€å‡ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶æŠŠ exit_code å‘Šè¯‰çˆ¶è¿›è½¦ã€‚kill(pid_t,KILL_TYPE) å‘æŸä¸ªè¿›ç¨‹å‘é€ç›¸åº”çš„é€€å‡ºä¿¡å·ã€‚<br>wait å‡½æ•°å®¶æ—ï¼Œè®©çˆ¶è¿›ç¨‹ç­‰å¾…æŸä¸ªå­è¿›ç¨‹çš„ç»“æŸã€‚WIFEXITED å®åˆ¤æ–­å­è¿›ç¨‹æ˜¯å¦æ­£å¸¸é€€å‡ºæˆ–è€…æ˜¯ç”±äºå…¶ä»–åŸå› æ„å¤–é€€å‡ºã€‚<br>zombie process(åƒµæ­»è¿›ç¨‹) ä¸ºä¸€ä¸ªè¿›ç¨‹å·²ç»é€€å‡ºï¼Œä½†æ˜¯æ²¡æœ‰è¿›è¡Œå–„åå¤„ç†ã€‚ä¸€ä¸ªçˆ¶è¿›ç¨‹æœ‰è´£ä»»å¤„ç†å­è¿›ç¨‹çš„å–„åå¤„ç†ï¼Œwait å‡½æ•°å³ä¸ºæ­¤ç”¨ï¼Œçˆ¶è¿›ç¨‹è°ƒç”¨ wait ä¸€ç›´è¢«é˜»å¡ (å½“å­è¿›ç¨‹æ²¡æœ‰é€€å‡ºçš„æ—¶å€™),å­è¿›ç¨‹é€€å‡ºå wait å‡½æ•°è¿”å›ã€‚å¦‚æœçˆ¶è¿›ç¨‹æ²¡æœ‰ä¸ºå·²ç»é€€å‡ºçš„å­è¿›ç¨‹å¤„ç†å–„åï¼Œå­è¿›ç¨‹å°†å˜ä¸º init çš„å­è¿›ç¨‹ï¼Œç„¶åè¢«å¤„ç†åˆ é™¤ã€‚<br>ä¸€ç§æ›´å¥½çš„å¤„ç†æ–¹æ³•æ˜¯å½“å­è¿›ç¨‹é€€å‡ºçš„æ—¶å€™å‘ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ï¼Œæœ‰å‡ ç§æ–¹å¼å¯ä»¥å®ç° (è¿›ç¨‹é—´é€šä¿¡),å…¶ä¸­ä¸€ç§æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹å¼æ˜¯çˆ¶è¿›ç¨‹å¤„ç† SIGCHLD ä¿¡å·ã€‚</p>
<h2><a name="sec10" id="sec10"></a><br>Threads</h2>

<p><p class="first">çº¿ç¨‹ä½œä¸ºäº²é‡çº§è¿›ç¨‹ï¼Œåˆ‡æ¢å¼•èµ·çš„å¼€é”€æ›´å°ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªå­çº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</p>
<h3>create thread</h3>

<p>åˆ›å»ºçº¿ç¨‹ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thread_id<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">(</span>pointer_to_thread_info<span class="token punctuation">)</span><span class="token punctuation">,</span> 
               <span class="token operator">&amp;</span>thread_func<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">(</span>argument<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½å‡è®¾å…¶æ‰§è¡Œé¡ºåºã€‚å‘ thread ä¼ é€’æ•°æ®ï¼šå¯ä»¥é€šè¿‡ pthread_create çš„åœ°å››ä¸ªå‚æ•°ï¼Œä¼ é€’ä¸€ä¸ª void* çš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°æ®ç»“æ„ä½“ã€‚æ³¨æ„åœ¨å¤šçº¿ç¨‹ä¸­çš„æ•°æ®ç©ºé—´çš„é”€æ¯ã€‚</p>
<p>More about thread_id:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">pthread_equal</span> <span class="token punctuation">(</span><span class="token function">pthread_self</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> other_thread<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">pthread_join</span> <span class="token punctuation">(</span>other_thread<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>Thread Attributesï¼Œä¸ºäº†è®¾å®šçº¿ç¨‹çš„æŸäº›å±æ€§ï¼Œdetach çº¿ç¨‹é€€å‡ºåè‡ªåŠ¨å›é¦–èµ„æºï¼Œjoinable åˆ™ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ pthread_jion è·å¾—å…¶è¿”å›å€¼ã€‚</p>
<p>Thread-specific data:æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä»½è‡ªå·±çš„æ‹·è´ï¼Œä¿®æ”¹è‡ªå·±çš„æ•°æ®ä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚</p>
<p>Cleanup Handlers:ä½¿ç”¨ pthread_cleanup_push(function,param) å’Œ pthread_cleanup_pop(int) åœ¨çº¿ç¨‹é€€å‡ºçš„æ—¶å€™è‡ªåŠ¨è°ƒç”¨æ¸…ç†å‡½æ•°ï¼Œé‡Šæ”¾èµ„æºã€‚</p>
<p>å¤šçº¿ç¨‹ç¨‹åºå¯èƒ½å‡ºç°çš„é—®é¢˜ï¼šç«äº‰ï¼Œéœ€è¦ä½¿ç”¨ atomic æ“ä½œã€‚</p>
<h3><a name="sec11" id="sec11"></a><br>äº’æ–¥é”</h3>

<p><p class="first">åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‹¥æœ‰ï¼Œæ­¤æ—¶å…¶ä»–çº¿ç¨‹è®¿é—®äº’æ–¥é”å°†è¢«é˜»å¡ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">pthread_mutex_t</span> mutex<span class="token punctuation">;</span>
<span class="token function">pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mutex<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//æˆ–è€… pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;</span>
<span class="token comment">//çº¿ç¨‹ä¸­ä½¿ç”¨ pthread_mutex_lock å’Œ pthread_mutex_unlock æ¥é”ä½å’Œè§£é”äº’æ–¥é”ï¼Œ</span>

<span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token operator">&lt;</span>a name<span class="token operator">=</span><span class="token string">"sec12"</span> id<span class="token operator">=</span><span class="token string">"sec12"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
Semaphores <span class="token keyword">for</span> Threads<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>

<span class="token operator">&lt;</span>p class<span class="token operator">=</span><span class="token string">"first"</span><span class="token operator">></span><span class="token class-name">sem_t</span> å¯ä»¥ä½œä¸ºä¸€ä¸ª share counter æ¥ä½¿ç”¨ï¼Œ

```c
<span class="token class-name">sem_t</span> job_queue_count<span class="token punctuation">;</span>

<span class="token comment">//initialize</span>
<span class="token function">sem_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>job_queue_count<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//wait for</span>
<span class="token function">sem_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>job_queue_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//lock mutext</span>
<span class="token comment">//and do somethting</span>
<span class="token comment">//unlock</span>

<span class="token comment">//new job</span>
<span class="token function">sem_post</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>job_queue_count<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3><a name="sec13" id="sec13"></a><br>Threads VS Process</h3>

<p><p class="first">Guidelines:</p>
<p>1ï¼Œæ‰€æœ‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„æŒ‡ä»¤å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢ï¼Œè€Œå¤šè¿›ç¨‹å¯ä»¥æ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚</p>
<p>2ï¼Œå› ä¸ºå¤šä¸ªçº¿ç¨‹å…±äº«ç›¸åŒçš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹çš„é”™è¯¯å¯èƒ½ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ï¼Œè€Œå¤šè¿›ç¨‹ç¨‹åºä¸­ä¸€ä¸ªè¿›ç¨‹çš„é”™è¯¯ä¸ä¼šå½±å“åˆ°å…¶ä»–è¿›ç¨‹ã€‚</p>
<p>3ï¼Œä¸ºæ–°è¿›ç¨‹æ‹·è´å†…å­˜å°†å¢åŠ å¼€é”€ï¼Œä½†æ˜¯åªæœ‰åœ¨æ–°è¿›ç¨‹å†™å…¶å†…å­˜çš„æ—¶å€™æ‰ä¼šè¿›è¡Œæ‹·è´ (å†™æ‹·è´)ã€‚</p>
<p>4ï¼Œå¤šçº¿ç¨‹é€‚ç”¨äºå¤šä¸ªç›¸ä¼¼çš„æ‰§è¡Œä»»åŠ¡ï¼Œè€Œå¤šè¿›ç¨‹å¯ä»¥æ‰§è¡Œä¸åŒç±»å‹çš„ä»»åŠ¡ã€‚</p>
<p>5ï¼Œå¤šä¸ªçº¿ç¨‹ä¸­å…±äº«æ•°æ®è¦å®¹ä¸€äº›ï¼Œä½†æ˜¯ä¹Ÿä¼šäº§ç”Ÿç›¸å…³é—®é¢˜ (æ¡ä»¶ç«äº‰ï¼Œæ­»é”)ï¼Œå¤šä¸ªè¿›ç¨‹å…±äº«æ•°æ®éš¾ä¸€äº›ï¼Œä½¿ç”¨ IPC æœºåˆ¶ï¼Œè™½ç„¶å®ç°è¦éš¾ä¸€äº›ï¼Œä½†æ˜¯ä¸å®¹æ˜“å‡ºç°å¹¶å‘ bugã€‚</p>
<h2><a name="sec14" id="sec14"></a><br>Interprocess Communication</h2>


<h3><a name="sec15" id="sec15"></a><br>Share Memory</h3>

<p><p class="first">share Memeory æ˜¯æœ€ç®€å•çš„è¿›ç¨‹é—´å…±äº«æ•°æ®çš„æ–¹å¼ã€‚</p>
<h4>Allocation</h4>

<p><p class="first">shmget å‡½æ•°åˆ›å»ºæˆ–è€…è®¿é—®ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ share memã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> segment_id <span class="token operator">=</span> <span class="token function">shmget</span> <span class="token punctuation">(</span>shm_key<span class="token punctuation">,</span> <span class="token function">getpagesize</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         IPC_CREAT <span class="token operator">|</span> S_IRUSR <span class="token operator">|</span> S_IWUSER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4>Attachment and Detachment</h4>

<p><p class="first">å‡½æ•° shmat(SHMID,pointer to address,flag) ä½¿å¾—ä¸€ä¸ªè¿›ç¨‹ attach åˆ°ä¸€ä¸ªå…±äº«å†…å­˜ã€‚è¿›ç¨‹é€šè¿‡ fork åˆ›å»ºçš„å­è¿›ç¨‹ä¹Ÿå°†ç»§æ‰¿è¿™ä¸€å…±äº«å†…å­˜ã€‚å‡½æ•° shmdt(address) å°† detach å…±äº«å†…å­˜ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> segment_size<span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">int</span> shared_segment_size<span class="token operator">=</span><span class="token number">0x6400</span><span class="token punctuation">;</span>

<span class="token comment">//allocate a shared mem</span>

segment_id<span class="token operator">=</span><span class="token function">shmget</span><span class="token punctuation">(</span>IPC_PRIVATE<span class="token punctuation">,</span>shared_segment_size<span class="token punctuation">,</span>
                  IPC_CREAT<span class="token operator">|</span>IPC_EXCL<span class="token operator">|</span>S_IRUSR<span class="token operator">|</span>S_IWUSR<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//atach the share mem</span>
share_memory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">shmat</span><span class="token punctuation">(</span>segment_id<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"share memory attached at addreass %p\n"</span><span class="token punctuation">,</span>share_memory<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4>Control share mem</h4>

<p><p class="first">å‡½æ•°è°ƒç”¨ exit æˆ–è€… exec å¯ä»¥ detach ä¸€ä¸ªå…±äº«å†…å­˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰é‡Šæ”¾å®ƒã€‚<br>å¿…é¡»è°ƒç”¨ shmctl å»é‡Šæ”¾å…¶ç©ºé—´ã€‚ipcs -m å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿä¸­å½“å‰çš„ share mem çš„ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰åˆ é™¤é—ç•™çš„ shared memï¼Œå…¶ nattch ä¸º 0ã€‚å¯ä»¥ä½¿ç”¨ ipcrm shm segment_id åˆ é™¤ã€‚</p>
<h3><a name="sec16" id="sec16"></a><br>Process Semaphores</h3>

<p><p class="first">semaphore å’Œ shared memory çš„ä½¿ç”¨æ–¹å¼ç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡ semget,shmctl åˆ›å»ºå’Œåˆ é™¤ï¼Œæä¾›çš„å‚æ•°è¡¨æ˜è¦åˆ›å»º semaphoreã€‚<br>æ²¡è¯¦ç»†è¯´ï¼ŒæŸ¥çœ‹å…¶ä»–ä¹¦ã€‚</p>
<h3><a name="sec17" id="sec17"></a><br>Mapped memory</h3>

<p><p class="first">Mapped memory æ˜¯ä¸åŒè¿›ç¨‹å¯ä»¥é€šè¿‡ä¸€ä¸ªå…¬ç”¨çš„å…±äº«æ–‡ä»¶è¿›è¡Œäº¤æµã€‚Mapped mem åœ¨è¿›ç¨‹æ˜¯è¿›ç¨‹å’Œæ–‡ä»¶çš„ä¸€ä¸ªæ¡¥æ¢ï¼Œlinux é€šè¿‡æŠŠæ–‡ä»¶æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ï¼Œè¿™æ ·è¿›ç¨‹å¯ä»¥åƒè®¿é—®æ™®é€šå†…å­˜ä¸€æ ·è®¿é—®è¯¥æ–‡ä»¶ã€‚<br>void* mmap(address,LENGTH,prot_option,option,file_rp,pos) //å°†ä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ° addressï¼Œå¦‚æœä¸æä¾›ç³»ç»Ÿå°†æ˜ å°„åˆ°åˆé€‚çš„åœ°å€<br>munmap(file_memory,FILE_LENGTH);// é‡Šæ”¾ memory<br>è®¾ç½®äº† MAP_SHAREDï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡åŒä¸€æ–‡ä»¶è®¿é—®è¯¥å†…å­˜åŒºã€‚</p>
<h3><a name="sec18" id="sec18"></a><br>ç®¡é“</h3>

<h4>pipe</h4>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> pipe_fds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> read_fd<span class="token punctuation">;</span>

<span class="token keyword">int</span> write_fd<span class="token punctuation">;</span>
<span class="token function">pipe</span> <span class="token punctuation">(</span>pipe_fds<span class="token punctuation">)</span><span class="token punctuation">;</span>
read_fd <span class="token operator">=</span> pipe_fds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
write_fd <span class="token operator">=</span> pipe_fds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>pipe_fds[0] ä¸º reading file desc,pipe_fds<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup>ä¸º writing file descã€‚Pipe åªèƒ½ç”¨äºåŒä¸€ä¸ªè¿›ç¨‹çš„å­è¿›ç¨‹ä¹‹é—´ã€‚<br>dup2 é‡å®šå‘æ ‡å‡†è¾“å…¥è¾“å‡ºç¬¦ã€‚</p>
<p>popen,pclose å¾ˆæ–¹ä¾¿ï¼ŒFILE* stream=popen(&quot;progam&quot;,&quot;w&quot;) å‘ program å‘é€ã€‚pclose(stream) å…³é—­ã€‚</p>
<h4>FIFO</h4>

<p><p class="first">ä¸ºæœ‰åå­—çš„ pipeï¼Œä»»ä½•ä¸ç›¸å…³çš„ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡ fifo æ¥è¿›è¡Œæ•°æ®ä¼ é€’ã€‚mkfifo å‡½æ•°åˆ›å»º FIFOã€‚</p>
<h3><a name="sec19" id="sec19"></a><br>Socket</h3>

<p><p class="first">ç³»ç»Ÿè°ƒç”¨ï¼š</p>
<pre class="example">
socket-- Creates a socket
close -- Destroys a socket
connect -- Creates a connection between two sockets
bind -- Labels a server socket with an address
listen -- Configures a socket to accept conditions
accept -- Accepts a connection and creates a new socket for the connection
</pre>

<p>Unix-domain sockets èƒ½ç”¨äºåŒä¸€æœºå™¨ä¸Šçš„è¿›ç¨‹é€šä¿¡ã€‚Internet-domain sockets ç”¨äºä¸åŒæœºå­ä¸Šçš„é€šä¿¡ã€‚<br>struct sockaddr_in  addr ç±»å‹å˜é‡ä¸ºå…¶åœ°å€ç»“æ„ã€‚<br>addr.sin_family=AF_INET<br>addr.sin_addr å­˜å‚¨ä¸€ä¸ª 32bit çš„ IP åœ°å€ã€‚</p>
<p>åªæ˜¯ç»™äº†ä¸¤ä¸ªç¨‹åºä¾‹å­ï¼Œè¯¦ç»†å†…å®¹çœ‹ç½‘ç»œç¼–ç¨‹ç›¸å…³ä¹¦ç±ã€‚</p>
<h2><a name="sec20" id="sec20"></a><br>Mastering Linux</h2>

<h3><a name="sec21" id="sec21"></a><br>Device</h3>

<p><p class="first">åˆ†ä¸ºå­—ç¬¦è®¾å¤‡å’Œå—è®¾å¤‡ï¼Œå—è®¾å¤‡å¯ä¸€éšæœºè®¿é—®ï¼Œå­—ç¬¦è®¾å¤‡æä¾›æµã€‚ä¸€èˆ¬åº”ç”¨ç¨‹åºä¸ä¼šç›´æ¥è®¿é—®å—è®¾å¤‡ï¼Œè€Œæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥ä½¿ç”¨å—è®¾å¤‡ã€‚<br>è®¾å¤‡å·ï¼Œä¸»è®¾å¤‡å·æ˜¯æ ¹æ®è®¾å¤‡ç±»å‹åˆ†çš„ï¼Œä»è®¾å¤‡å·æ ¹æ®å…·ä½“è®¾å¤‡åˆ†ã€‚<br>cat /proc/devices æŸ¥çœ‹è®¾å¤‡ç±»å‹å’Œä¸»è®¾å¤‡å·ã€‚</p>
<h3><a name="sec22" id="sec22"></a><br>Device Entry</h3>

<p><p class="first">åªæœ‰ root çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ mknod åˆ›å»ºæ–°çš„ Device Entryã€‚<br>mknod name b/c ä¸»è®¾å¤‡å· ä»è®¾å¤‡å·</p>
<p>linux ç›®å½•/dev ä¸‹é¢æ˜¯ç³»ç»Ÿæ‰€æ”¯æŒçš„ Device Entryã€‚<br>å­—ç¬¦è®¾å¤‡å¯ä»¥åƒä¸€èˆ¬æ–‡ä»¶ä¸€æ ·è®¿é—®ï¼Œç”šè‡³å¯ä»¥ç”¨é‡å®šå‘å»è®¿é—®ã€‚</p>
<pre class="example">
cat somefile &gt; /dev/audio
å¯ä»¥å‘å‡ºå£°éŸ³äº†

</pre>

<p>ç‰¹æ®Šè®¾å¤‡ï¼š/dev/null /dev/zero /dev/full /dev/random /dev/urandom<br>Loopback Devices:ç¯å›è®¾å¤‡ï¼Œåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ–°å»ºä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œå¯ç”¨äºæ¨¡æ‹Ÿç‰¹å®šè®¾å¤‡ï¼Œæ¯”å¦‚è½¯ç›˜ã€‚<br>ä¹Ÿå¯æŠŠå®é™…è®¾å¤‡ä¸­çš„å†…å®¹æ‹·è´åˆ°å…¶ä¸­ï¼Œæ¯”å¦‚æŠŠå…‰ç›˜ä¸­çš„å†…å®¹æ‹·è´åˆ°æ–°å»ºçš„ä¸€ä¸ª cdrom-image ä¸­ã€‚</p>
<h3><a name="sec23" id="sec23"></a><br>/proc</h3>

<p><p class="first">mount å‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸€è¡Œè¾“å‡ºï¼šproc on /proc type proc (rw,noexec,nosuid,nodev)<br>/proc åŒ…å«ç³»ç»Ÿçš„ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œä¸å’Œä»»ä½•è®¾å¤‡ç›¸å…³è”ã€‚</p>
<pre class="example">
$cat /proc/version æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬
$cat /proc/cpuinfo æŸ¥çœ‹ cpu ä¿¡æ¯
</pre>

<p>/proc ç›®å½•ä¸‹åŒæ—¶åŒ…å«ç³»ç»Ÿä¸­å½“å‰çš„è¿›ç¨‹ä¿¡æ¯ï¼Œç”±äºæƒé™è®¾ç½®ï¼Œæœ‰çš„åªèƒ½ç”±è¿›ç¨‹æœ¬èº«è®¿é—®ã€‚å¯ä»¥é€šè¿‡è®¿é—®æ–‡ä»¶è·å–ç³»ç»Ÿä¸­è¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯ï¼Œ<br>æ¯”å¦‚å‚æ•°ï¼Œè¿è¡Œç¯å¢ƒï¼Œå†…å­˜ä½¿ç”¨ä¿¡æ¯ç­‰ç­‰ã€‚</p>
<h2><a name="sec24" id="sec24"></a><br>Linux system call</h2>

<p>system call å’Œä¸€èˆ¬çš„ C åº“å‡½æ•°çš„åŒºåˆ«ï¼šç³»ç»Ÿè°ƒç”¨ä¸€èˆ¬é€šè¿‡é—¨é™·å…¥å®ç°ï¼Œæ˜¯ç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·ç¨‹åºçš„æ¥å£ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ä¼šè¿›å…¥ç³»ç»Ÿå†…æ ¸ã€‚C åº“å‡½æ•°ä¸€èˆ¬å’Œæ™®é€šçš„å‡½æ•°æ²¡æœ‰åŒºåˆ«ã€‚</p>
<p>strace:è¯¥å‘½ä»¤å¯ä»¥è¿½è¸ªä¸€ä¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„è°ƒç”¨çš„ system callã€‚<br><br>access:æµ‹è¯•è¿›ç¨‹å¯¹äºä¸€ä¸ªæ–‡ä»¶çš„æƒé™ã€‚ int access(path,bit_flag),æ³¨æ„è¿”å›å€¼å’Œ errnoã€‚<br><br>fcntl:é”ä½æ–‡ä»¶å’Œæ§åˆ¶æ–‡ä»¶æ“ä½œã€‚<br><br>fsync,fdatasync:flush disk bufferã€‚<br><br>getrlimit,setrlimit:èµ„æºé™åˆ¶è®¾ç½®ã€‚<br><br>getusage:è·å–è¿›ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯ã€‚<br><br>gettimeofday:è·å– wall_clock timeã€‚<br><br>mlock:é”ä½ä¸€æ®µç‰©ç†å†…å­˜ï¼Œä½¿å¾—è¯¥å†…å­˜ä¸èƒ½å› ä¸º swap æ¢å‡ºï¼Œä¸€äº›é€Ÿåº¦è¦æ±‚å¾ˆé«˜çš„å’Œå®‰å…¨æ€§è¦æ±‚å¾ˆé«˜çš„ä»£ç ä¼šä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚ mlock(address,mem_length)<br><br>mprotect:è®¾ç½®å†…å­˜çš„æƒé™ã€‚<br><br>nanosleep:é«˜åˆ†è¾¨ç‡ç¡çœ å‡½æ•°ã€‚<br></p>
<p>readlink:read symbolic linksã€‚<br><br>sendfile:Fast file Transferã€‚<br><br>setitimer:å®šæ—¶å™¨ã€‚<br><br>sysinfo:è·å–ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯ã€‚<br><br>uname:è·å–ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯å’Œç¡¬ä»¶ä¿¡æ¯ã€‚<br></p>
<h2><a name="sec25" id="sec25"></a><br>Inline Assembly Code</h2>

<p><p class="first">/usr/include/asm/io.h å®šä¹‰äº†æ±‡ç¼–ä»£ç ä¸­èƒ½å¤Ÿç›´æ¥è®¿é—®çš„ç«¯å£ã€‚<br>/usr/src/linux/include/asm and /usr/src/linux/include/asm-i386 linux å†…æ ¸ä¸­æ±‡ç¼–ä»£ç å¤´æ–‡ä»¶<br>/usr/src/linux/arch/i386/ and /usr/src/linux/drivers/  æ±‡ç¼–ä»£ç <br>å½“ä½¿ç”¨ç‰¹å®šå¹³å°çš„æ±‡ç¼–ä»£ç æ—¶ä½¿ç”¨å®å’Œå‡½æ•°æ¥ç®€åŒ–å…¼å®¹é—®é¢˜ã€‚</p>
<h2><a name="sec26" id="sec26"></a><br>Security</h2>

<h3><a name="sec27" id="sec27"></a><br>ç”¨æˆ·ç»„ æ–‡ä»¶ è¿›ç¨‹æƒé™</h3>

<p>ç”¨æˆ·å’Œç»„çš„æ¦‚å¿µ<br><br>è¶…çº§ç”¨æˆ· æ— ç©·æƒåŠ›<br></p>
<p>proccess user id å’Œ proccess group idã€‚è¿›ç¨‹å¼€å§‹çš„æ—¶å€™å…¶ id å’Œå¯åŠ¨è¯¥ç¨‹åºçš„ç”¨æˆ·ä¿¡æ¯ç›¸åŒã€‚<br><br>æ–‡ä»¶æƒé™ chmod stat(filename,&amp;(struct stat))<br><br>program without Execution Permissions: a security holeã€‚ å…¶ä»–ç”¨æˆ·èƒ½å¤Ÿæ‹·è´è¯¥æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹å…¶æƒé™ã€‚<br><br>Sticky bit:ç”¨äºæ–‡ä»¶å¤¹ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶å¤¹çš„ sticky bit è®¾ç½®äº†åï¼Œè¦åˆ é™¤è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¿…é¡»æ‹¥æœ‰å¯¹è¯¥æ–‡ä»¶çš„æ‹¥æœ‰æƒï¼Œå³ä½¿å·²ç»æ‹¥æœ‰è¯¥æ–‡ä»¶å¤¹è®¿é—®æƒã€‚Linux ä¸‹çš„/tmp è®¾ç½®äº† sticky bitã€‚<br><br>Real and Effective ID::EID ä»£è¡¨è¿›ç¨‹æ‰€å…·æœ‰çš„ç³»ç»Ÿæƒé™ï¼Œå¦‚æœæ˜¯é root ç”¨æˆ·ï¼ŒEID=RIDï¼›åªæœ‰ root ç”¨æˆ·å¯ä»¥æ”¹å˜å®ƒçš„ EID ä¸ºä»»ä½•æœ‰æ•ˆçš„ç”¨æˆ· IDã€‚<br><br>su å‘½ä»¤ï¼šæ˜¯ä¸€ä¸ª setuid ç¨‹åºï¼Œå½“ç¨‹åºæ‰§è¡Œçš„æ—¶å€™å…¶ EID æ˜¯æ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼Œè€Œä¸æ˜¯å¯åŠ¨ç¨‹åºçš„ç”¨æˆ·å·ã€‚chmod a+s ä½¿å¾—æ–‡ä»¶æœ‰è¿™ä¸ªå±æ€§ã€‚<br></p>
<h3><a name="sec28" id="sec28"></a><br><br>ç¼“å†²åŒºæ¼æ´</h3>


<p>å¦‚æœæ ˆä¸­æœ‰å›ºå®šé•¿åº¦çš„è¾“å…¥åŒºï¼Œåˆ™ä¼šå«æœ‰ç¼“å†²åŒºæ¼æ´ã€‚æœ€é€šå¸¸çš„å½¢å¼ï¼š</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> username<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">/</span> Prompt the user <span class="token keyword">for</span> the username<span class="token punctuation">.</span> <span class="token operator">/</span>
<span class="token function">printf</span> <span class="token punctuation">(</span>â€œEnter your username<span class="token operator">:</span> â€œ<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">/</span> Read a line of input<span class="token punctuation">.</span> <span class="token operator">/</span>
<span class="token function">gets</span> <span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">/</span> Do other things hereâ€¦ <span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ”»å‡»è€…å¯ä»¥æ•…æ„ä½¿å¾—ç¼“å†²åŒºè¯»æ»¡ï¼Œç„¶ååœ¨è¶…å‡ºçš„åŒºåŸŸæ¤å…¥æƒ³æ‰§è¡Œçš„ä»£ç æ®µï¼Œè·å¾—æ§åˆ¶æƒã€‚</p>
<h3><a name="sec29" id="sec29"></a><br>Race Conditions in /tmp</h3>

<p><p class="first">æ”»å‡»è€…å…ˆåˆ›å»ºä¸€ä¸ªé“¾æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨/tmp ä¸‹åˆ›å»ºæ‰“å¼€ä¸€ä¸ªç›¸åŒåç§°çš„æ–‡ä»¶ï¼Œæ‰€æœ‰å†™å…¥çš„æ•°æ®å°†ä¼ é€åˆ°é“¾æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶é‡Œã€‚<br>è§£å†³æ–¹æ³•ï¼šåœ¨æ–‡ä»¶åç§°å†…ä½¿ç”¨ Randomï¼Œopen å‡½æ•°ä½¿ç”¨ O_EXCL å‚æ•°ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™å¤±è´¥ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åç”¨ lstat æŸ¥çœ‹æ˜¯å¦æ˜¯é“¾æ¥æ–‡ä»¶ï¼Œæ£€æŸ¥æ–‡ä»¶çš„æ‰€æœ‰è€…æ˜¯å¦å’Œè¿›ç¨‹æ‰€æœ‰è€…ä¸€æ ·ã€‚<br>/tmp æ–‡ä»¶ä¸èƒ½æŒ‚è½½åœ¨ NFS ä¸‹ï¼Œå› ä¸º O_EXCL ä¸èƒ½åœ¨ NFS æ–‡ä»¶ç³»ç»Ÿä¸‹ä½¿ç”¨ã€‚</p>
<h3><a name="sec30" id="sec30"></a><br>system ,popen å‡½æ•°çš„å±é™©</h3>

<p><p class="first">æ›¿ä»£ä½¿ç”¨ exec æ—å‡½æ•°ã€‚<br><!-- Page published by Emacs Muse ends here --></p>
</section>

    <p></p>
    <!-- äºŒç»´ç  START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.jpg" height="160" width="160">
            <figcaption>å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»</figcaption>
      </div>
    

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#Linux" >
    <span class="tag-code">Linux</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2011/07/22/wumpus-and-2.html">
        <span class="nav-arrow">â† </span>
        
          Wumpus and ã€ŠLand of Lispã€‹
        
      </a>
    
    
      <a class="nav-right" href="/2011/06/07/554.html">
        
          ä»è±†ç“£ FM ä¸‹è½½å–œæ¬¢çš„éŸ³ä¹
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->

    <!-- äºŒç»´ç  END -->
    
      <!-- No Comment -->
    

    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title"></strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">Writing and using Libraries</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Archives</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Shared Library</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Pros and Cons</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
åŠ¨æ€åŠ è½½å’Œå¸è½½åº“</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
è¿›ç¨‹</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
åˆ›å»ºè¿›ç¨‹</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">using system</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">using fork and exec</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">process scheduling</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
signal</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
process exit</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Threads</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">create thread</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
äº’æ–¥é”</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Threads VS Process</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Interprocess Communication</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Share Memory</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">Allocation</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">Attachment and Detachment</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">Control share mem</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Process Semaphores</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Mapped memory</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
ç®¡é“</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">pipe</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link"><span class="toc-nav-text">FIFO</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Socket</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Mastering Linux</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Device</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Device Entry</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
&#x2F;proc</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Linux system call</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Inline Assembly Code</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link"><span class="toc-nav-text">
Security</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
ç”¨æˆ·ç»„ æ–‡ä»¶ è¿›ç¨‹æƒé™</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">

ç¼“å†²åŒºæ¼æ´</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
Race Conditions in &#x2F;tmp</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-text">
system ,popen å‡½æ•°çš„å±é™©</span></a></li></ol></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://catcoding.me/2011/06/14/advanced-linux-porg-notes.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW * 3 / 4}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy;
        2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a> with <a target="_blank" rel="noopener" href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
    </p>
</footer>

<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function(e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("//catcoding.me/js/fastclick.min.js", function() {
        FastClick.attach(document.body);
    })
</script>


<script src="/js/script.js"></script>

  </body>
</html>