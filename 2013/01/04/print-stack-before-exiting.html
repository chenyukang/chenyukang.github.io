<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="All about coding and writing">
  <meta name="keyword" content="Programming, Programming Languages, Algorithms, Tools">
  <meta property="og:site_name" content="ç¨‹åºå‘˜çš„å–µ">
  <meta property="og:title" content="è·å–æŒ‚æ‰ç¨‹åºçš„æ ˆä¿¡æ¯ | ç¨‹åºå‘˜çš„å–µ" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="" />
  <meta property="og:description" content="åœ¨ç¨‹åºé€€å‡ºçš„æ—¶å€™è·å–æ ˆä¿¡æ¯" />
  <meta property="og:image" content="http://catcoding.me/css/images/logo.png" />

  <link rel="alternate" type="application/rss+xml" title="ç¨‹åºå‘˜çš„å–µ; Feed" href="https://catcoding.me/atom.xml" />
  
    <link rel="shortcut icon" href="/css/images/favicon.ico">
  
  <title>
      
          è·å–æŒ‚æ‰ç¨‹åºçš„æ ˆä¿¡æ¯ | ç¨‹åºå‘˜çš„å–µ
      
  </title>
  
  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/fonts.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/code.css">

  
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">

  
<script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
<script src="/js/highlight.min.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/geopattern.min.js"></script>
<script src="/js/nprogress.min.js"></script>


  <div style='margin:0 auto;width:0px;height:0px;overflow:hidden;'>
      <img src="/css/images/logo.png" width='400px' height='400px'/>
  </div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-77282254-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-77282254-1');
</script>

<meta name="generator" content="Hexo 5.4.2"></head>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>ç¨‹åºå‘˜çš„å–µ</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      

       <li class="list-item" style="margin-left: 3px">
        <a class="icon-small" href="/atom.xml">
         <span class="fa-stack fa-lg">
           <i class="fa fa-rss fa-inverse" style="color:orange"></i>
         </span>
        </a>
       </li>
    </ul>

    
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>è·å–æŒ‚æ‰ç¨‹åºçš„æ ˆä¿¡æ¯</h2>
  <p class="post-date">2013-01-04</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>


<main class="app-body flex-box" style="max-width: 850px" >

  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>åœ¨ç¨‹åºæŒ‚æ‰çš„æ—¶å€™æœ€å¥½è¿˜æ˜¯ç•™ç‚¹æœ‰ç”¨çš„é—è¨€ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¸€äº›æ¯”è¾ƒéš¾é‡ç°çš„ Bugï¼Œä¹Ÿè®¸è¿™äº›ä¿¡æ¯ä¼šæˆä¸ºè§£å†³é—®é¢˜çš„å…³é”®ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªæŠ€å·§å¯ä»¥è®©ç¨‹æŒ‚æ‰çš„æ—¶å€™æ‰“å°å‡ºæ¥æ ˆä¿¡æ¯ã€‚è¿™ä¸ªåŠæ³•æ¥è‡ª<a target="_blank" rel="noopener" href="http://neugierig.org/software/blog/2012/06/backtraces.html">è¿™é‡Œ</a>, æˆ‘è§‰å¾—æŠŠ SIGABRTã€SIGBUS ä¿¡å·åŠ è¿›å»ä¹ŸæŒºå¥½çš„ï¼Œåœ¨æ­¤åšäº†ç‚¹ä¿®æ”¹ã€‚æ›¾ç»å°ä¹Ÿè¯•è¿‡ glibc çš„ backtrace å‡½æ•°ï¼Œï¼Œä½†æ˜¯ç»™çš„ä¿¡æ¯ä¸å…¨ (æ²¡æœ‰è¡Œå·)ï¼Œå¯¹æ­¤åšå¾—æœ€å¥½çš„è¿˜æ˜¯ gdbã€‚ åœ¨ç»ˆç«¯å¯ä»¥ç”¨ gdb è·å–æŸä¸ªè¿›ç¨‹çš„å½“å‰æ ˆï¼š</p>
<pre><code>$ gdb -p 5595 -batch -ex bt
0xb7fb4410 in __kernel_vsyscall ()
#0  0xb7fb4410 in __kernel_vsyscall ()
#1  0xb7dc2d50 in nanosleep () from /lib/tls/i686/cmov/libc.so.6
#2  0xb7dc2b87 in sleep () from /lib/tls/i686/cmov/libc.so.6
#3  0x0804874f in main () at print_stack.cc:64
</code></pre><p>é‚£ä¹ˆä¸€ä¸ªå¥½çš„åŠæ³•å°±æ˜¯åœ¨ç¨‹åºå¼€å§‹çš„æ—¶å€™è®¾ç½®å¥½ä¿¡å·ï¼Œç»‘å®š SIGSEGV å’Œ SIGABRT åˆ° DumpBackTrace() å‡½æ•°ï¼ŒDumpBackTrace å‡½æ•° fork å‡ºæ¥ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œè¿è¡Œä¸Šé¢çš„å‘½ä»¤æ¥è·å–è°ƒç”¨æ ˆã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;signal.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpBacktrace</span><span class="hljs-params">(<span class="hljs-type">int</span>)</span> </span>&#123;<br>    <span class="hljs-type">pid_t</span> dying_pid = <span class="hljs-built_in">getpid</span>();<br>    <span class="hljs-type">pid_t</span> child_pid = fork();<br>    <span class="hljs-keyword">if</span> (child_pid &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;fork() while collecting backtrace:&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child_pid == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">char</span> buf[<span class="hljs-number">1024</span>];<br>        <span class="hljs-built_in">sprintf</span>(buf, <span class="hljs-string">&quot;gdb -p %d -batch -ex bt 2&gt;/dev/null | &quot;</span><br>                <span class="hljs-string">&quot;sed &#x27;0,/&lt;signal handler/d&#x27;&quot;</span>, dying_pid);<br>        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* argv[] = &#123;<span class="hljs-string">&quot;sh&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, buf, <span class="hljs-literal">NULL</span>&#125;;<br>        <span class="hljs-built_in">execve</span>(<span class="hljs-string">&quot;/bin/sh&quot;</span>, (<span class="hljs-type">char</span>**)argv, <span class="hljs-literal">NULL</span>);<br>        _exit(<span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">waitpid</span>(child_pid, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>);<br>    &#125;<br>    _exit(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BacktraceOnSegv</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">sigaction</span> action = &#123;&#125;;<br>    action.sa_handler = DumpBacktrace;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sigaction</span>(SIGSEGV, &amp;action, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;sigaction(SEGV)&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sigaction</span>(SIGABRT, &amp;action, <span class="hljs-literal">NULL</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;sigaction(SEGV)&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">//assert(0);</span><br>    <span class="hljs-type">int</span>* p = <span class="hljs-number">0</span>;<br>    *p = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-built_in">BacktraceOnSegv</span>();<br>    <span class="hljs-built_in">test</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>å¦å¤–å‰æ®µæ—¶é—´çœ‹åˆ°è¿™ç¯‡æ–‡ç« <a target="_blank" rel="noopener" href="http://www.runswift.ly/solving-bugs.html">Solving vs. Fixing</a>å†™å¾—ä¸é”™ï¼Œåœ¨é¢å¯¹ä¸€ä¸ª bug çš„æ—¶å€™ï¼Œå…ˆä¸è¦æ€¥äºç«‹é©¬ä¸Š gdb è°ƒè¯•ï¼Œæ ¹æ®ç°æœ‰çš„ä¿¡æ¯å¥½å¥½æ€è€ƒä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªæƒ…å†µã€‚<br>Reddit ä¸Šçš„ä¸€ä¸ªå¾—åˆ†æœ€é«˜çš„å›å¤ï¼š</p>
<pre><code>The ability to reason about code is probably the most important skill. 
But it is sadly rare, and doesn&apos;t seem to be taught much, if at all.
Some things are simple, others take some more thought:

* Under what conditions will this branch get taken?
* What could cause this API to fail?
* Are all these parameters even valid?
* What sequence of events could lead to this situation?
* What assumptions does this code make?
* What side-effects does this code have?
* What contract is this code making (or breaking)?

The most talented engineer I know, when presented with a bug, does nothing but 
read the code and think about the code and how it could fail. 
Most of the time,  he just figures it out in his head and fixes it. 
Sometimes he will insert some strategic printfs and narrow it down like that. 
I don&apos;t think I have ever seen him use a debugger, 
even on the most complex of problems.
</code></pre></section>

    <p></p>
    <!-- äºŒç»´ç  START -->
    
        <div class="qrcode">
            <img src="/images/wechat-qr-code.jpg" height="160" width="160">
            <figcaption>å…¬å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ‘»</figcaption>
      </div>
    

    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Programming" >
    <span class="tag-code">Programming</span>
  </a>

  <a href="/tags#C/C++" >
    <span class="tag-code">C/C++</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2013/01/22/poj-500.html">
        <span class="nav-arrow">â† </span>
        
          è¿Ÿåˆ°çš„ POJ 500
        
      </a>
    
    
      <a class="nav-right" href="/2012/12/26/browser-objs-in-ruby.html">
        
          Browser objs and class hierarchy  in Ruby
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->

    <!-- äºŒç»´ç  END -->
    
      <!-- No Comment -->
    

    <script src="https://utteranc.es/client.js"
      repo="chenyukang/chenyukang.github.io"
      issue-term="pathname"
      theme="github-light"
      crossorigin="anonymous"
      async>
    </script>

  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://catcoding.me/2013/01/04/print-stack-before-exiting.html';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer" id="footer">
    <p class="copyright">
        &copy;
        2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a> with <a target="_blank" rel="noopener" href="https://github.com/yanm1ng/hexo-theme-vexo">Vexo</a>
    </p>
</footer>

<script>
    function async(u, c) {
        var d = document,
            t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function(e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    async("//catcoding.me/js/fastclick.min.js", function() {
        FastClick.attach(document.body);
    })
</script>

<script>
    var hasLine = 'false';
    async("//catcoding.me/js/highlight.min.js", function() {
        $('figure pre').each(function(i, block) {
            var figure = $(this).parents('figure');
            if (hasLine === 'false') {
                figure.find('.gutter').hide();
            }
            var lang = figure.attr('class').split(' ')[1] || 'code';
            var codeHtml = $(this).html();
            var codeTag = document.createElement('code');
            codeTag.className = lang;
            codeTag.innerHTML = codeHtml;
            $(this).attr('class', '').empty().html(codeTag);
            figure.attr('data-lang', lang.toUpperCase());
            hljs.highlightBlock(block);
        });
    })
</script>

<script src="/js/script.js"></script>

  </body>
</html>